{{let "qr_height" 180 }}
{{let "qr_width" 180 }}
  {{#with data}}
  {{#each ballot_data}}
  <div class="report">
    <!-- MAIN section -->
    <table align="center" style="width: 100%">
      <tr>
        <td style="text-align: center; padding: 10px 0">
          <div style="width: 100%">
            <!-- Inner table section -->
            <table style="width: 100%" class="top-header">
              <!-- End of report section -->
              <tr>
                <td align="left">
                  <table style="width: 100%">
                    <tr>
                      <td class="left">
                        <div>
                          <p>
                            {{datetime from_rfc3339=../execution_annotations.date_printed
                            output_format="%B %d, %Y %H:%M"
                            with_timezone="UTC"}}
                          </p>
                        </div>
                      </td>
                      <td class="right"></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <!-- End of report section -->

              <!-- Logo printer block -->
              <tr>
                <td>
                  <table class="main-header">
                    <td class="left logo-printer-block" valign="top">
                        <img src="sequent-logo.svg" />
                    </td>
                  </table>
                </td>
              </tr>
              <!-- Logo printer block -->

              <!-- Document header block -->
              <tr>
                <td>
                  <table class="main-header">
                    <td width="23%" class="left" valign="top">
                        <img src="sequent-logo.svg" />
                    </td>
                    <td width="54%" class="center">
                    <div class="country">SEQUENT ONLINE VOTING</div>
                    <div class="commission">COMMISSION ON ELECTIONS</div>
                      <div class="election-date">
                        {{datetime
                        from_rfc3339=../execution_annotations.date_printed
                        output_format="%B %d, %Y" with_timezone="UTC"}}
                      </div>
                      <div class="election-name">
                        {{sanitize_html (expr ../election_name)}}
                      </div>
                      <div class="online">
                        ONLINE VOTING AND COUNTING SYSTEM
                      </div>
                      <div class="voting-period">
                        Voting Period: {{datetime
                        from_rfc3339=../election_dates.scheduled_event_dates.ALLOW_INIT_REPORT.scheduled_at
                        output_format="%d %B %Y" with_timezone="UTC"}} - {{datetime
                        from_rfc3339=../election_dates.scheduled_event_dates.END_VOTING_PERIOD.scheduled_at
                        output_format="%d %B %Y"
                        with_timezone="UTC"}}
                      </div>
                    </td>
                    <td width="23%" class="right" valign="top">
                      <img
                        src="" />
                    </td>
                  </table>
                </td>
              </tr>
              <!-- Document header block -->
            </table>
          </div>
        </td>
      </tr>

      <!-- Main title -->
      <tr class="main-title">
        <td align="center">
          <p>
            <strong>{{../../extra_data.title}}</strong>
          </p>
        </td>
      </tr>
      <!-- Main title -->

      <!-- Additional sections -->
      <tr>
        <td>
          <div>
            <table class="stats-table">
              <colgroup>
                <col class="first-col">
                <col class="second-col">
              </colgroup>
              <tr>
                <td class="key">
                  <strong>Geographical Region:</strong>
                </td>
                <td class="value">
                  {{sanitize_html (expr ../election_annotations.geographical_region)}}
                </td>
              </tr>
              <tr>
                <td class="key post">
                  <strong>Post:</strong>
                </td>
                <td class="value">
                  {{sanitize_html (expr ../election_annotations.post)}}
                </td>
              </tr>
              <tr>
                <td class="key">
                  <strong>Country:</strong>
                </td>
                <td class="value">
                  {{sanitize_html (expr ../area)}}
                </td>
              </tr>
              <tr>
                <td class="key">
                  <strong>Voting Center:</strong>
                </td>
                <td class="value">
                  {{sanitize_html (expr ../election_annotations.post)}}
                </td>
              </tr>
               <tr>
                 <td class="key">
                <strong>Clustered Precinct ID:</strong>
              </td>
              <td class="value">
                {{sanitize_html (expr ../election_annotations.pollcenter_code)}}
              </td>
            </tr>
            <tr>
              <td class="key">
                <strong>Precincts in the Cluster:</strong>
              </td>
              <td class="value">
                {{sanitize_html (expr ../election_annotations.clustered_precint_id)}}
              </td>
              </tr>
            </table>
          </div>
        </td>
      </tr>
      <!-- END of additional sections -->

      <tr>
        <td>
        <div class="contest-title">
          <strong>Ballot ID</strong>
        </div>
        <div class="ballot-serial-number">
          {{sanitize_html (expr id)}}
        </div>
      </td>
      </tr>
      <!-- Contest section -->
      {{#each contest_choices}}
      <!-- Candidates section -->
      <tr class="stats-table">
        {{#if ../is_blank }}
        <td>
          <strong>ABSTENTION</strong>
        </td>
        {{else}}
        <td>
          <div class="contest-title">
            <strong>{{contest.name}}</strong>
          </div>
          <table class="candidates">
            <colgroup>
              <col class="first-col">
            </colgroup>
            <tbody>
              {{#each decoded_choices}}
              {{#if (gte this.choice.selected 0)}}
              <tr>
                <div class="candidate">
                  <div class="candidate-name">{{this.candidate.name}}</div>
                </div>
              </tr>
              {{/if}}
              {{/each}}
            </tbody>
          </table>
          {{#if  (gte this.overvotes 1)}}
          <strong>{{this.overvotes}} OVERVOTE/S</strong>
          {{/if}}
          {{#if (gte this.undervotes 1)}}
          <strong>{{this.undervotes}} UNDERVOTE/S</strong>
          {{/if}}
        </td>
        {{/if}}
      </tr>
      <!-- END Candidates section -->
      {{/each}}
      <!-- END Contest section -->

      <!-- QR CODES section -->
      <tr class="qr-codes">
        <td align="center">
           <div style="height: {{qr_height}};">
              <div class="qrcode" id="qrcode-{{@index}}"></div>
            </div>
          </td>
      </tr>
      <!-- END QR CODES section -->

      <!-- Left paragraph section -->
      <tr class="sys-info">
        <td align="center">
          <div class="word-break">
            Report hash: {{sanitize_html (expr ../execution_annotations.report_hash)}}<br />
            <br />
            Software version: {{sanitize_html (expr ../execution_annotations.app_version)}}<br />
            OVCS version: {{sanitize_html (expr ../execution_annotations.app_version)}}<br />
            System hash: {{sanitize_html (expr ../execution_annotations.app_hash)}}
          </div>
        </td>
      </tr>
      <!-- END Left paragraph section -->
      <!-- End of report section -->
      <tr class="report-end">
        <td align="center">
          <div>
            <hr />
            <p>End of Report</p>
          </div>
        </td>
      </tr>
      <!-- End of report section -->
    </table>
  </div>
  {{/each}}
  {{/with}}
  <script>
 window.onload = function () {
      const ballotData = {{{to_json data.ballot_data}}};
      ballotData.forEach((ballot, index) => {
        let qrText = '{{{extra_data.title}}}'
        const qrcodeDiv = document.getElementById(`qrcode-${index}`);
        if (qrcodeDiv) {
          ballot.contest_choices.forEach((contest) => {
            qrText += `: ${contest.contest.name}`; 
            contest.decoded_choices.forEach((decodedChoice) => {
              if (decodedChoice.choice.selected >= 0) {
                  isBlank = false;
                  qrText += `: ${decodedChoice.candidate.name}`;
              }
              });
          });

          if (isBlank) {
            qrText = "ABSTENTION";
          }

          let qrHeight = parseInt({{qr_height}}, 10);
          let qrWidth = qrHeight = parseInt({{qr_width}}, 10);
          new QRCode(qrcodeDiv, {
            text: qrText,
            width: qrWidth,
            height: qrHeight,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H,
          });
        }
      });
  };
</script>
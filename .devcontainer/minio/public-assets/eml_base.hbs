{{!--
SPDX-FileCopyrightText: 2024 Felix Robles <felix@sequentech.io>

SPDX-License-Identifier: AGPL-3.0-only
--}}

<EML Id="510" SchemaVersion="7.0" xmlns="urn:oasis:names:tc:evs:schema:eml">
  <EMLHeader>
    <TransactionId>{{data.header.transaction_id}}</TransactionId>
    <IssueDate>{{data.header.issue_date}}</IssueDate>
    <OfficialStatusDetail>
      <OfficialStatus>{{data.header.official_status_detail.official_status}}</OfficialStatus>
      <StatusDate>{{data.header.official_status_detail.status_date}}</StatusDate>
    </OfficialStatusDetail>
  </EMLHeader>
  {{#each data.counts as |count|}}
    <Count>
      <EventIdentifier IdNumber="{{count.identifier.id_number}}">
        <EventName>{{count.identifier.name}}</EventName>
      </EventIdentifier>
      {{#each count.elections as |election|}}
        <Election>
          <ElectionIdentifier IdNumber="{{election.identifier.id_number}}">
            <ElectionName>{{election.identifier.name}}</ElectionName>
          </ElectionIdentifier>
          <Contests>
            {{#each election.contests as |contest|}}
              <Contest>
                <ContestIdentifier IdNumber="{{contest.identifier.id_number}}">
                  <ContestName>{{contest.identifier.name}}</ContestName>
                </ContestIdentifier>
                <TotalVotes>
                  {{#each contest.total_votes.count_metrics as |metric|}}
                    <CountMetric Type="{{metric.kind}}" Id="{{metric.id}}">{{metric.datum}}</CountMetric>
                  {{/each}}
                  {{#each contest.total_votes.selections as |selection|}}
                    <Selection>
                      {{#each selection.candidates as |candidate|}}
                        <Candidate>
                          <CandidateIdentifier IdNumber="{{candidate.identifier.id_number}}">
                            <CandidateName>{{candidate.identifier.name}}</CandidateName>
                          </CandidateIdentifier>
                          <StatusDetails>
                            {{#each candidate.status_details as |status|}}
                              <StatusItem setting="{{status.setting}}" />
                            {{/each}}
                          </StatusDetails>
                          {{#if (ne candidate.affiliation.identifier.id_number "")}}
                            {{#if (ne candidate.affiliation.identifier.id_number " ")}}
                              <Affiliation>
                                <AffiliationIdentifier IdNumber="{{candidate.affiliation.identifier.id_number}}">
                                    <RegisteredName>{{candidate.affiliation.identifier.name}}</RegisteredName>
                                </AffiliationIdentifier>
                                <Type>{{candidate.affiliation.party}}</Type>
                              </Affiliation>
                            {{/if}}
                          {{/if}}
                        </Candidate>
                      {{/each}}
                      <ValidVotes>{{selection.valid_votes}}</ValidVotes>
                    </Selection>
                  {{/each}}
                </TotalVotes>
              </Contest>
            {{/each}}
          </Contests>
        </Election>
      {{/each}}
    </Count>
  {{/each}}
</EML>

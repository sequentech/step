<!--
 SPDX-FileCopyrightText: 2025 Sequent Tech Inc <legal@sequentech.io>

SPDX-License-Identifier: AGPL-3.0-only
-->

# Velvet

**Velvet** -- A type of woven tufted fabric, implying smoothness and luxury.

Velvet is Sequent Voting Platform pipeline-based tally subsystem.

You can call velvet from the command line like this:

```bash
velvet run {stage} {optional-pipe} \
  --config ./path/to/velvet-config.json \
  --input-dir ./path/to/input-dir \
  --output-dir ./path/to/output-dir
```

See more: 

https://github.com/sequentech/step/blob/main/docs/design/velvet/README.md

## Unit testing

You can execute unit tests with:

```bash
cargo test
```

Or execute one specific test, for example the test `cli::test_all::tests::test_hierarchical_area_aggregation`, with:

```bash
cargo test -- cli::test_all::tests::test_hierarchical_area_aggregation
```

Sometimes you want to inspect the files generated by velvet. However, the unit
tests typically cleanup all the files. This can be disabled setting up the env
var `CLEANUP_FILES=false`:

```bash
export CLEANUP_FILES=false
cargo test -- cli::test_all::tests::test_hierarchical_area_aggregation
```

## Development

For example if you are testing a specific ballot images template, you could do:

```bash
cargo build
# update velvet config with ballot images template
python3 testing/bin/utils/update_velvet_config.py \
    --config-path ./velvet-config.json \
    --template-path ./src/resources/ballot_images.hbs && \

# run velvet
rm -rf output2; \
cargo run --bin velvet -- run \
    main decode-ballots \
    --config ./velvet-config.json \
    --input-dir ./input \
    --output-dir ./output2
```

{{!--
SPDX-FileCopyrightText: 2024 Sequent Tech <legal@sequentech.io>

SPDX-License-Identifier: AGPL-3.0-only
--}}

<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vote receipts</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.js"></script>
    
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: auto;
      max-width: 640px;
    }

    h1,
    h2,
    h3,
    h4 {
      margin-top: 48px;
      margin-bottom: 48px;
    }

    .logo {
      content: url("https://sequentech.io/wp-content/uploads/2022/05/Sequent-logo-positive-1.svg");
      text-align: center;
      margin: 16px auto;
    }

    .main {
      margin-top: 32px;
    }

    .main div {
      margin-top: 32px;
    }

    .id-content {
      print-color-adjust: exact;
      font-family: monospace;
      font-size: 11px;
      padding: 6px 12px;
      background: #ecfdf5;
      color: #191d23;
      border-radius: 4px;
    }

    .info {
      margin: 32px 0;
    }

    .info p {
      margin: 12px 0;
    }

    .ballot {
      border: 3px dashed #43E3A1;
      border-radius: 4px;
      padding: 32px;
    }

    @media print {
      .next-page {
        page-break-after: always;
      }
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin: 20px 0;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    th.invalid-blank, td.invalid-blank {
      width: 50%;
    }
      
    td.checkbox {
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
      text-align: center;
    }

    thead tr {
      border-bottom: 2px solid #ccc;
    }

    tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    input[type="checkbox"] {
      margin-right: 5px;
    }

    .qrcode {
      margin-top: 32px;
      display: flex;
      justify-content: center;
    }

    .text-center {
      text-align: center;
    }
  </style>
</head>

  <body>
    <div class="content">
      <div class="logo"></div>
      <h1 class="text-center">Vote Receipts</h1>
      <div id="dateDiv"></div>
      <div class="next-page"></div>
      
      {{#each data.receipts}}
        <div class="ballot next-page">
          <h3 style="margin-top: 0; margin-bottom: 12px;" class="text-center">Contest: {{sanitize_html ../data.contest.name}}</h3>
          <h4>Ballot No #{{@index}}</h4>
  
          <div class="qrcode" id="qrcode-{{@index}}-{{this.encoded_vote}}"></div>

          {{#unless this.is_blank_or_invalid}}
            <table>
              <thead>
                <tr>
                  <th></th>
                  <th>Selected Candidates</th>
                </tr>
              </thead>
              <tbody>
                {{#each this.selected_candidates}}
                  <tr>
                    <td class="checkbox"><input type="checkbox" checked /></td>
                    <td class="text-center">{{this.name}}</td>
                  </tr>
                {{/each}}
              </tbody>
            </table>
          {{/unless}}
          
          <table>
            <thead>
              <tr>
                <th class="invalid-blank">Invalid vote</th>
                <th class="invalid-blank">Blank</th>
              </tr>
            </thead>
            <tbody>
                <tr>
                  <td class="invalid-blank checkbox">
                    {{#if this.is_invalid}}
                      <input type="checkbox" checked />
                    {{/if}}
                    {{#unless this.is_invalid}}
                      <input type="checkbox" />
                    {{/unless}}
                  </td>
                  <td class="invalid-blank checkbox">
                    {{#if this.is_blank}}
                      <input type="checkbox" checked />
                    {{/if}}
                    {{#unless this.is_blank}}
                      <input type="checkbox" />
                    {{/unless}}
                  </td>
                </tr>
            </tbody>
          </table>
          
        </div>
      {{/each}}
    </div>

    <!-- QR Codes -->
    <script>
      {{#each data.receipts}}
        new QRCode(document.getElementById("qrcode-{{@index}}-{{this.encoded_vote}}"), {
            text: '{{@index}};{{this.encoded_vote}}',
            width: 100,
            height: 100,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H,
        })
      {{/each}}
    </script>

    <!-- Report date -->
    <script>
      // Get the current date
      var currentDate = new Date();

      // Format the date as a string (e.g., "April 11, 2024")
      var dateString = currentDate.toLocaleDateString('en-US', {
          year: 'numeric', // Four digit year
          month: 'long', // Full name of the month
          day: 'numeric', // Day of the month
          hour: '2-digit',
          minute: '2-digit',
          timeZoneName: 'short'
      });

      // Set the text of the div to the formatted date string
      document.getElementById('dateDiv').textContent = dateString;
    </script>
  </body>
</html>

# SPDX-FileCopyrightText: 2021 David Ruescas <david@sequentech.io>
# SPDX-FileCopyrightText: 2022 FÃ©lix Robles <felix@sequentech.io>
# SPDX-FileCopyrightText: 2022 Eduardo Robles <edu@sequentech.io>
#
# SPDX-License-Identifier: AGPL-3.0-only
[package]
name = "strand"
version = "0.4.0"
authors = [
  "David Ruescas <david@sequenttech.io>",
  "Eduardo Robles <edulix@sequenttech.io>"
]
license = "AGPL-3.0-only"
edition = "2021"

[lib]
crate-type = ["cdylib", "rlib"]
bench = false

[features]
rayon = ["dep:rayon"]
wasmrayon = ["rayon", "wasm", "dep:wasm-bindgen-rayon"]
wasmtest = ["wasm", "dep:web-sys"]
wasm = ["wasm-bindgen", "serde-wasm-bindgen", "num_bigint", "getrandom/js"]
num_bigint = ["dep:num-bigint", "dep:num-traits", "dep:num-integer", "dep:num-modular"]
malachite = ["dep:malachite"]
openssl_core = ["dep:openssl", "dep:rand_core"]
openssl_full = ["dep:openssl", "dep:rand_core"]
fips_core = ["openssl_core"]
fips_full = ["openssl_full"]
rustcrypto_interop_test = []

[dependencies]

# Backends
# See https://docs.rs/curve25519-dalek/latest/curve25519_dalek/#simd-backend to select simd backend
curve25519-dalek = { version = "=4.1", features = [] } # Depends on digest 10.0 which is stuck at getrandom-0.2.15
num-bigint = { version = "0.4", features = ["rand"], optional = true }
num-traits = { version = "0.2", optional = true }
num-integer = { version = "0.1", optional = true }
num-modular = { version = "=0.5", features = ["num-bigint"], optional = true } # Pinned to avoid compile errors at the moment
malachite = { version = "0.6", default-features = false, features = ["naturals_and_integers"], optional = true }
rug = { version = "~1.23", default-features = false, features = ["integer", "rand"], optional = true }

# Signatures
ed25519-dalek = { version = "=2.1", features = ["rand_core", "pkcs8"] }
ecdsa = {version = "0.16", features = ["signing"] }
p384 = "0.13"

# certificates
x509-parser = "0.17.0"
rcgen = {version = "0.14.5", features = ["x509-parser"] }
rustls-pki-types = "=1.13.0"

# symmetric
chacha20poly1305 = "0.10"
generic-array = "=0.14"

# Hashing
sha2 = "0.10"
# Needed for extendable hashing function when deriving generators for ristretto
sha3 = "0.10"

# Serialization
# borsh = "0.9.3"
borsh = { version = "1.5", features = ["derive"] }
base64 = "0.22.1"

# RNG
rand = { package="rand", version = "=0.8" } # 0.9 will break because uses getrandom v0.3.2 which requires config flag changes for wasm32-unknown-unknown targets
rand_core = { version = "0.9", optional = true }
getrandom = { version = "=0.2", optional = true } # curve25519-dalek depends on digest v10.0 which is stuck at getrandom-0.2.15

# WASM
# Note: Using specific version of wasm-bindgen to match Nix version
wasm-bindgen-rayon = {version = "1.3", features = ["no-bundler"], optional = true}
wasm-bindgen = {version = "=0.2.100", optional = true}
serde-wasm-bindgen = {version = "0.6", optional = true}
web-sys = { version = "0.3", features = ['Performance'], optional = true }

# RNG, ecdsa, sha512, shake256, aes-gcm
# OpenSSL needs to be configured to operate in FIPS mode
# https://github.com/sfackler/rust-openssl/issues/1924
# https://www.openssl.org/docs/man3.0/man7/fips_module.html
openssl = { version = "0.10", optional = true }

rayon = { version = "1.5", optional = true }
cfg-if = "1.0"
thiserror = "2.0"

# Only needed for wasm demo
serde = { version = "1.0.215", features = ["derive"] }

# Used for debug impl and demo
hex = { version = "0.4" }

[dev-dependencies]
criterion = "0.5"
serde_json = "1.0"

[build-dependencies]
rustc_version = "0.4"

[[bench]]
name = "shuffle"
harness = false
# remove this to run benchmark
# bench = false

[[bench]]
name = "encrypt"
harness = false

[[bench]]
name = "verify_ballot"
harness = false
# remove this to run benchmark
# bench = false

<!--
SPDX-FileCopyrightText: 2024 Felix Robles <felix@sequentech.io>

SPDX-License-Identifier: AGPL-3.0-only

-->
# janitor

Janitor is an conversion tool. It converts a sql dump and an excel file
into an election event configuration that can be imported through the
admin-portal.

## Installation

Before using it, you need python3 and pip. In Ubuntu, you can install it with:

    sudo apt update
	sudo apt install -y python3 python3-pip

If you're in a codespace, you need to install and configure virtualenv:

	pip install --user virtualenvwrapper
	export PATH=$PATH:~/.local/bin
	export WORKON_HOME=~/.virtualenvs
	export VIRTUALENVWRAPPER_PYTHON=$(which python3)
	source $(find /nix/store/ -name "virtualenvwrapper.sh" | grep python3)
	source ~/.bashrc
	mkvirtualenv janitor
	workon janitor

Then you need to install the packages the script uses:

    cd /workspaces/step/packages/windmill/external-bin/janitor
	pip install -r requirements.txt

# Configuration

You'll need to add the COMELEC keycloak template. Upload it to 
/workspaces/step/packages/windmill/external-bin/janitor/templates/COMELEC/keycloak.hbs

# Use

The script has two inputs, a postgres dump file (.sql), and an excel (.xls) file.
You can use the example files hereby included:

    cd /workspaces/step/packages/windmill/external-bin/janitor
    python3 ./run.py ./import-data/ovcs_ver7.sql ./import-data/29-09-2024-event-import.xlsx

The output files are:

    - `output/election_config.json`. This is the election event json that you
      can import in the admin portal.
    - `logs/process_log.log`. Logs generated by the tool.
  
The tool also prints some output to provide feedback on the process.

# tenant configuration

You can change the tenant id in the file `janitor/config/baseConfig.json`.
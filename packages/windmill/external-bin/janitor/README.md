<!--
SPDX-FileCopyrightText: 2024 Felix Robles <felix@sequentech.io>

SPDX-License-Identifier: AGPL-3.0-only

-->
# janitor

Janitor is a conversion tool. It converts a zip with the Miru OCF files and an excel file
into an election event configuration that can be imported through the admin-portal.
 
## Installation

Before using it, you need to configure the python environment. In Ubuntu, run this command (as a non-root user):

```bash
cd janitor
source ./setup.sh
```

## Use

The script has two inputs, a zip with the OCF files, and an excel (.xls) file.
You can use the example files hereby included:

```bash
cd janitor
python3 ./run.py import-data/OCF-0-20241122.zip 17-12-2024-parameters-reports.xlsx
```

The output files are:
- `output/election-event.zip`. This is the election event zip that you
	can import in the admin portal.
- `admins.csv`. CSV to be imported to configure the admin users, including sbei users.
- `tenants.zip`. Configuration for the tenant (keycloak config, settings and roles).
  
The tool also prints some output to provide feedback on the process.

## Tenant configuration

Once you've run janitor, you should import the tenant configuration.

For that, in the admin portal go to Settings > Backup /Restore. In the section named "Restore Tenant config" check
all the check boxes and click "Restore". After that a new section will pop up from the
right. Drag and drop the file `tenants.zip` and click on Import.

You should perform the import of the tenant configuration both in the Offline EMS
and in the Online EMS to ensure the tenant configuration is the same.

If you make any changes to the Offline EMS tenant configuration, you can also export that
configuration and then import it in the Online EMS. For exporting the tenant configuration,
in the admin portal go to Settings > Backup /Restore and click the `Restore` button. This
will download a file equivalent of the `tenants.zip` file generated by janitor but with the
changes you've done included. Then you can import that configuration in the Enline EMS following
the procedure described above.


## tenant configuration

You can change the tenant id in the file `janitor/config/baseConfig.json`.

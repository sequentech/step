"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7420],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},8472:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"developers/Braid/braid_trustees_configuration","title":"Braid Trustees Configuration Guide","description":"This document provides a comprehensive guide to configuring Braid Trustees, which are critical components in the STEP voting system responsible for managing cryptographic keys and participating in the election process.","source":"@site/docs/developers/Braid/braid_trustees_configuration.md","sourceDirName":"developers/Braid","slug":"/developers/Braid/braid_trustees_configuration","permalink":"/docusaurus/pr-preview/pr-1985/docs/developers/Braid/braid_trustees_configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/sequentech/step/docs/docusaurus/docs/developers/Braid/braid_trustees_configuration.md","tags":[],"version":"current","frontMatter":{"id":"braid_trustees_configuration","title":"Braid Trustees Configuration Guide","sidebar_label":"Braid Trustees Configuration"},"sidebar":"docs","previous":{"title":"Developers Windmill","permalink":"/docusaurus/pr-preview/pr-1985/docs/developers/Windmill/developers_windmill"},"next":{"title":"Load Testing","permalink":"/docusaurus/pr-preview/pr-1985/docs/cli/Tutorials/Load-Testing/load_testing"}}');var s=r(4848),t=r(8453);const o={id:"braid_trustees_configuration",title:"Braid Trustees Configuration Guide",sidebar_label:"Braid Trustees Configuration"},c="Braid Trustees Configuration Guide",d={},l=[{value:"Overview",id:"overview",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Required Configuration",id:"required-configuration",level:4},{value:"Optional Configuration",id:"optional-configuration",level:4},{value:"Secrets Backend Options",id:"secrets-backend-options",level:3},{value:"1. AWS Secrets Manager (<code>AwsSecretManager</code>)",id:"1-aws-secrets-manager-awssecretmanager",level:4},{value:"2. HashiCorp Vault (<code>HashiCorpVault</code>)",id:"2-hashicorp-vault-hashicorpvault",level:4},{value:"3. Environment Variable (<code>EnvVarMasterSecret</code>)",id:"3-environment-variable-envvarmastersecret",level:4},{value:"Configuration File",id:"configuration-file",level:3},{value:"Configuration Generation",id:"configuration-generation",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Logging",id:"logging",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"braid-trustees-configuration-guide",children:"Braid Trustees Configuration Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This document provides a comprehensive guide to configuring Braid Trustees, which are critical components in the STEP voting system responsible for managing cryptographic keys and participating in the election process."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Braid Trustees are containerized services that handle key generation, management, and cryptographic operations during elections. Each trustee holds a share of the election's private key, ensuring that no single entity can decrypt votes without cooperation from other trustees."}),"\n",(0,s.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(n.p,{children:"The following environment variables can be used to configure Braid Trustees:"}),"\n",(0,s.jsx)(n.h4,{id:"required-configuration",children:"Required Configuration"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Variable"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Required"}),(0,s.jsx)(n.th,{children:"Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TRUSTEE_NAME"})}),(0,s.jsx)(n.td,{children:"Unique identifier for the trustee instance"}),(0,s.jsx)(n.td,{children:"Yes*"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"B3_URL"})}),(0,s.jsx)(n.td,{children:"URL of the B3 service for trustee communication"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IMMUDB_URL"})}),(0,s.jsx)(n.td,{children:"ImmuDB database connection URL"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IMMUDB_USER"})}),(0,s.jsx)(n.td,{children:"ImmuDB username for authentication"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IMMUDB_PASSWORD"})}),(0,s.jsx)(n.td,{children:"ImmuDB password for authentication"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["*Required unless ",(0,s.jsx)(n.code,{children:"TRUSTEE_CONFIG_PATH"})," is set with an existing configuration file."]}),"\n",(0,s.jsx)(n.h4,{id:"optional-configuration",children:"Optional Configuration"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Variable"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Required"}),(0,s.jsx)(n.th,{children:"Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TRUSTEE_CONFIG_PATH"})}),(0,s.jsx)(n.td,{children:"Path to the trustee configuration file"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/opt/braid/trustee.toml"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SECRETS_BACKEND"})}),(0,s.jsx)(n.td,{children:"Backend service for secrets management"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AwsSecretManager"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AWS_SM_KEY_PREFIX"})}),(0,s.jsx)(n.td,{children:"Prefix for AWS Secrets Manager keys"}),(0,s.jsx)(n.td,{children:"Conditional*"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VAULT_SERVER_URL"})}),(0,s.jsx)(n.td,{children:"HashiCorp Vault server URL"}),(0,s.jsx)(n.td,{children:"Conditional**"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VAULT_TOKEN"})}),(0,s.jsx)(n.td,{children:"HashiCorp Vault authentication token"}),(0,s.jsx)(n.td,{children:"Conditional**"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TRUSTEE_CONFIG"})}),(0,s.jsx)(n.td,{children:"Direct configuration content (for EnvVarMasterSecret backend)"}),(0,s.jsx)(n.td,{children:"Conditional***"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IGNORE_BOARDS"})}),(0,s.jsx)(n.td,{children:"Boards to ignore during processing"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["*Required when ",(0,s.jsx)(n.code,{children:"SECRETS_BACKEND"})," is set to ",(0,s.jsx)(n.code,{children:"AwsSecretManager"})," and no existing config file is present."]}),"\n",(0,s.jsxs)(n.p,{children:["**Required when ",(0,s.jsx)(n.code,{children:"SECRETS_BACKEND"})," is set to ",(0,s.jsx)(n.code,{children:"HashiCorpVault"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["***Used when ",(0,s.jsx)(n.code,{children:"SECRETS_BACKEND"})," is set to ",(0,s.jsx)(n.code,{children:"EnvVarMasterSecret"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"secrets-backend-options",children:"Secrets Backend Options"}),"\n",(0,s.jsx)(n.p,{children:"The trustee supports three different secrets management backends:"}),"\n",(0,s.jsxs)(n.h4,{id:"1-aws-secrets-manager-awssecretmanager",children:["1. AWS Secrets Manager (",(0,s.jsx)(n.code,{children:"AwsSecretManager"}),")"]}),"\n",(0,s.jsx)(n.p,{children:"When using AWS Secrets Manager:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"SECRETS_BACKEND=AwsSecretManager"})]}),"\n",(0,s.jsxs)(n.li,{children:["Provide ",(0,s.jsx)(n.code,{children:"AWS_SM_KEY_PREFIX"})," for key namespacing"]}),"\n",(0,s.jsx)(n.li,{children:"The trustee will store/retrieve configuration from AWS Secrets Manager"}),"\n",(0,s.jsxs)(n.li,{children:["Secret key format: ",(0,s.jsx)(n.code,{children:"${AWS_SM_KEY_PREFIX}secrets/${TRUSTEE_NAME}_config"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'export SECRETS_BACKEND="AwsSecretManager"\nexport AWS_SM_KEY_PREFIX="production/elections/"\nexport TRUSTEE_NAME="trustee-1"\n'})}),"\n",(0,s.jsxs)(n.h4,{id:"2-hashicorp-vault-hashicorpvault",children:["2. HashiCorp Vault (",(0,s.jsx)(n.code,{children:"HashiCorpVault"}),")"]}),"\n",(0,s.jsx)(n.p,{children:"When using HashiCorp Vault:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"SECRETS_BACKEND=HashiCorpVault"})]}),"\n",(0,s.jsxs)(n.li,{children:["Provide ",(0,s.jsx)(n.code,{children:"VAULT_SERVER_URL"})," and ",(0,s.jsx)(n.code,{children:"VAULT_TOKEN"})]}),"\n",(0,s.jsx)(n.li,{children:"The trustee will store/retrieve configuration from Vault"}),"\n",(0,s.jsxs)(n.li,{children:["Secret key format: ",(0,s.jsx)(n.code,{children:"secrets/${TRUSTEE_NAME}_config"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'export SECRETS_BACKEND="HashiCorpVault"\nexport VAULT_SERVER_URL="https://vault.example.com:8200"\nexport VAULT_TOKEN="s.XXXXXXXXXXXXXXXXXXXXXXXX"\nexport TRUSTEE_NAME="trustee-1"\n'})}),"\n",(0,s.jsxs)(n.h4,{id:"3-environment-variable-envvarmastersecret",children:["3. Environment Variable (",(0,s.jsx)(n.code,{children:"EnvVarMasterSecret"}),")"]}),"\n",(0,s.jsx)(n.p,{children:"When using environment variables directly:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"SECRETS_BACKEND=EnvVarMasterSecret"})]}),"\n",(0,s.jsxs)(n.li,{children:["Provide configuration directly via ",(0,s.jsx)(n.code,{children:"TRUSTEE_CONFIG"})," environment variable"]}),"\n",(0,s.jsx)(n.li,{children:"Useful for development or when secrets are managed externally"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'export SECRETS_BACKEND="EnvVarMasterSecret"\nexport TRUSTEE_NAME="trustee1"\nexport TRUSTEE_CONFIG="signing_key_sk = \\"MC4CAQAwBQYDK2VwBCIEIJAtmrHtGFYiS5tUQepIlrFtCCcKHeSzzuJ2pZqH4bat\\"\nsigning_key_pk = \\"MCowBQYDK2VwAyEAy1vJM4P85hJ1WAPZpRX3/QsOT2usIAuVy4/+t5VHHDs=\\"\nencryption_key = \\"lQr2vrVuZJ5PAoOkVSfLfuIG7mxt8exlgAnRMBi+4rg\\""\nexport TRUSTEE_CONFIG_PATH="/opt/braid/trustee-new.toml"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-file",children:"Configuration File"}),"\n",(0,s.jsxs)(n.p,{children:["If you prefer to use a configuration file instead of secrets management, you can mount a ",(0,s.jsx)(n.code,{children:"trustee.toml"})," file at the path specified by ",(0,s.jsx)(n.code,{children:"TRUSTEE_CONFIG_PATH"}),". When a configuration file exists at this path, the trustee will use it instead of querying the secrets backend."]}),"\n",(0,s.jsxs)(n.p,{children:["Example ",(0,s.jsx)(n.code,{children:"trustee.toml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'signing_key_sk = "MC4CAQAwBQYDK2VwBCIEIJAtmrHtGFYiS5tUQepIlrFtCCcKHeSzzuJ2pZqH4bat"\nsigning_key_pk = "MCowBQYDK2VwAyEAy1vJM4P85hJ1WAPZpRX3/QsOT2usIAuVy4/+t5VHHDs="\nencryption_key = "lQr2vrVuZJ5PAoOkVSfLfuIG7mxt8exlgAnRMBi+4rg"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-generation",children:"Configuration Generation"}),"\n",(0,s.jsxs)(n.p,{children:["If no configuration exists (either as a file or in the secrets backend), the trustee will automatically generate a new configuration using the ",(0,s.jsx)(n.code,{children:"gen_trustee_config"})," utility. This ensures that trustees can be deployed without manual configuration preparation."]}),"\n",(0,s.jsx)(n.p,{children:"The generated configuration will be:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Created by ",(0,s.jsx)(n.code,{children:"gen_trustee_config"})]}),"\n",(0,s.jsxs)(n.li,{children:["Stored in the configured secrets backend (if not using ",(0,s.jsx)(n.code,{children:"EnvVarMasterSecret"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Written to ",(0,s.jsx)(n.code,{children:"TRUSTEE_CONFIG_PATH"})," for use by the trustee process"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Secrets Management"}),": Always use a proper secrets backend in production. The ",(0,s.jsx)(n.code,{children:"EnvVarMasterSecret"})," option should only be used for development."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Network Security"}),": Ensure that communication between trustees, B3 service, and ImmuDB is properly secured using TLS."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Access Control"}),": Limit access to trustee configuration and secrets to authorized personnel only."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Storage"}),": The trustee's cryptographic keys are critical. Ensure proper backup and access control procedures."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Missing TRUSTEE_NAME"}),': If you see "Error: TRUSTEE_NAME must be set", ensure you\'ve provided either:']}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"TRUSTEE_NAME"})," environment variable, or"]}),"\n",(0,s.jsxs)(n.li,{children:["A configuration file at ",(0,s.jsx)(n.code,{children:"TRUSTEE_CONFIG_PATH"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Missing AWS_SM_KEY_PREFIX"}),": When using AWS Secrets Manager, this prefix is required to namespace your secrets properly."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration Generation Failures"}),": Check that the ",(0,s.jsx)(n.code,{children:"gen_trustee_config"})," binary is available in the container and has proper permissions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Secrets Backend Connection Issues"}),": Verify network connectivity and authentication credentials for your chosen secrets backend."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,s.jsx)(n.p,{children:"The trustee startup script logs important events with timestamps. Monitor these logs for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Configuration source (file, secrets backend, or generated)"}),"\n",(0,s.jsx)(n.li,{children:"Successful configuration writes"}),"\n",(0,s.jsx)(n.li,{children:"Connection attempts to external services"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docusaurus/pr-preview/pr-1985/docs/admin_portal/Reference/User-Manual/Settings/settings_trustees",children:"Admin Portal Trustees Settings"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);
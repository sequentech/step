"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3468],{1661:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"developers/Velvet/velvet_tally","title":"Tally Engine","description":"\x3c!--","source":"@site/docs/developers/07-Velvet/03-tally.md","sourceDirName":"developers/07-Velvet","slug":"/developers/Velvet/velvet_tally","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_tally","draft":false,"unlisted":false,"editUrl":"https://github.com/sequentech/step/docs/docusaurus/docs/developers/07-Velvet/03-tally.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"velvet_tally","title":"Tally Engine","sidebar_position":3},"sidebar":"docs","previous":{"title":"Pipes","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_pipes"},"next":{"title":"Counting Algorithms","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_algorithms"}}');var i=l(4848),s=l(8453);const r={id:"velvet_tally",title:"Tally Engine",sidebar_position:3},o="Tally Engine",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Ballot Processing",id:"ballot-processing",level:2},{value:"Invalid Votes",id:"invalid-votes",level:2},{value:"Extended Metrics",id:"extended-metrics",level:2},{value:"Result Structure",id:"result-structure",level:2},{value:"Location",id:"location",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"tally-engine",children:"Tally Engine"})}),"\n",(0,i.jsx)(n.p,{children:"The tally engine is the core component responsible for counting votes and determining election results."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The tally engine processes decoded ballots using a specified counting algorithm to produce:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Vote totals for each candidate"}),"\n",(0,i.jsx)(n.li,{children:"Percentage of votes received"}),"\n",(0,i.jsx)(n.li,{children:"Valid, invalid, and blank vote counts"}),"\n",(0,i.jsx)(n.li,{children:"Extended metrics for analysis"}),"\n",(0,i.jsx)(n.li,{children:"Winner determination (if applicable)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsxs)(n.p,{children:["The tally engine is implemented in the ",(0,i.jsx)(n.code,{children:"do_tally"})," pipe and consists of:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tally struct"})," - Holds ballot data, contest configuration, and census information"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Counting algorithms"})," - Pluggable algorithms that implement different electoral systems"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Result aggregation"})," - Combines results from multiple areas or districts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metrics tracking"})," - Records detailed statistics about the voting process"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ballot-processing",children:"Ballot Processing"}),"\n",(0,i.jsx)(n.p,{children:"Ballots go through several stages:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validation"})," - Check if ballots are valid, invalid, or blank"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Counting"})," - Apply the counting algorithm based on the electoral system"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Aggregation"})," - Combine results from multiple voting areas"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metric calculation"})," - Compute percentages and statistics"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"invalid-votes",children:"Invalid Votes"}),"\n",(0,i.jsx)(n.p,{children:"The tally engine handles different types of invalid votes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Explicit invalid"})," - Voter intentionally marked ballot as invalid"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implicit invalid"})," - Ballot is invalid due to errors (e.g., overvoting)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Blank votes"})," - Ballot has no selections"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Invalid vote handling can be configured per election."}),"\n",(0,i.jsx)(n.h2,{id:"extended-metrics",children:"Extended Metrics"}),"\n",(0,i.jsx)(n.p,{children:"The tally engine tracks detailed metrics including:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Total ballots cast"}),"\n",(0,i.jsx)(n.li,{children:"Number of valid ballots"}),"\n",(0,i.jsx)(n.li,{children:"Number of invalid ballots (explicit and implicit)"}),"\n",(0,i.jsx)(n.li,{children:"Number of blank ballots"}),"\n",(0,i.jsx)(n.li,{children:"Voter participation rates"}),"\n",(0,i.jsx)(n.li,{children:"Per-candidate vote distributions"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"result-structure",children:"Result Structure"}),"\n",(0,i.jsx)(n.p,{children:"Tally results include:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"ContestResult {\n    contest: Contest,\n    census: u64,\n    auditable_votes: u64,\n    total_votes: u64,\n    total_valid_votes: u64,\n    total_invalid_votes: u64,\n    total_blank_votes: u64,\n    candidate_result: Vec<CandidateResult>,\n    extended_metrics: ExtendedMetricsContest,\n    // ... percentage fields\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each candidate result contains:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"CandidateResult {\n    candidate: Candidate,\n    total_count: u64,\n    percentage_votes: f64,\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"location",children:"Location"}),"\n",(0,i.jsxs)(n.p,{children:["Tally engine implementation: ",(0,i.jsx)(n.code,{children:"/packages/velvet/src/pipes/do_tally/"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Further documentation to be added."})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>o});var t=l(6540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);
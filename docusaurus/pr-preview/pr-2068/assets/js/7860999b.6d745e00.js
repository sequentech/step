"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1979],{1327:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"developers/Velvet/velvet_introduction","title":"Velvet Introduction","description":"\x3c!--","source":"@site/docs/developers/07-Velvet/01-introduction.md","sourceDirName":"developers/07-Velvet","slug":"/developers/Velvet/velvet_introduction","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_introduction","draft":false,"unlisted":false,"editUrl":"https://github.com/sequentech/step/edit/main/docs/docusaurus/docs/developers/07-Velvet/01-introduction.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"velvet_introduction","title":"Velvet Introduction","sidebar_position":1},"sidebar":"docs","previous":{"title":"IdP SSO Design & Implementation","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Keycloak/idp_initiated_sso_design_implementation"},"next":{"title":"Pipes","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_pipes"}}');var s=i(4848),r=i(8453);const l={id:"velvet_introduction",title:"Velvet Introduction",sidebar_position:1},o="Velvet",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Pipes",id:"pipes",level:3},{value:"Tally Engine",id:"tally-engine",level:3},{value:"Counting Algorithms",id:"counting-algorithms",level:3},{value:"CLI",id:"cli",level:3},{value:"Tests",id:"tests",level:3},{value:"Benchmarks",id:"benchmarks",level:3},{value:"Workflow",id:"workflow",level:2},{value:"Integration with Admin Portal",id:"integration-with-admin-portal",level:2},{value:"Design Documentation",id:"design-documentation",level:2},{value:"Package Location",id:"package-location",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"velvet",children:"Velvet"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Velvet"})," is the tallying and reporting engine for the Sequent Tech voting platform. The name comes from the type of woven tufted fabric, implying smoothness and luxury in processing election results."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Velvet is a Rust cargo crate that provides both a library and a binary executable for processing election results. It handles the entire post-voting workflow including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Decoding encrypted ballots"}),"\n",(0,s.jsx)(n.li,{children:"Executing tally algorithms"}),"\n",(0,s.jsx)(n.li,{children:"Generating reports and receipts"}),"\n",(0,s.jsx)(n.li,{children:"Producing verifiable results"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["While Velvet includes a CLI tool for testing and development, its primary use is as a library integrated into the platform's backend services. The main functionality is triggered from the ",(0,s.jsx)(n.strong,{children:"Admin Portal"})," when an election administrator executes a tally."]}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.p,{children:"Velvet is organized around several key components:"}),"\n",(0,s.jsx)(n.h3,{id:"pipes",children:"Pipes"}),"\n",(0,s.jsx)(n.p,{children:"Pipes are the core processing units in Velvet. Each pipe performs a specific task in the tallying workflow:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"decode_ballots"})," - Decodes encrypted ballots into plaintext votes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"do_tally"})," - Executes the counting algorithm on decoded ballots"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"generate_db"})," - Creates a SQLite database with tally results"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"generate_reports"})," - Produces PDF and CSV reports"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"mark_winners"})," - Determines winning candidates based on tally results"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"vote_receipts"})," - Generates individual vote receipts for voters"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Pipes can be chained together in a processing pipeline defined by configuration."}),"\n",(0,s.jsx)(n.h3,{id:"tally-engine",children:"Tally Engine"}),"\n",(0,s.jsxs)(n.p,{children:["The tally engine (",(0,s.jsx)(n.code,{children:"do_tally"}),") is responsible for executing counting algorithms on ballots. It supports multiple electoral systems through a pluggable algorithm architecture."]}),"\n",(0,s.jsx)(n.h3,{id:"counting-algorithms",children:"Counting Algorithms"}),"\n",(0,s.jsx)(n.p,{children:"Velvet supports various counting algorithms for different electoral systems:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Plurality at Large"})," - Simple majority voting where candidates with the most votes win"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Instant Runoff Voting (IRV)"})," - Ranked-choice voting with elimination rounds"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Each algorithm implements the ",(0,s.jsx)(n.code,{children:"CountingAlgorithm"})," trait, making it easy to add new electoral systems."]}),"\n",(0,s.jsx)(n.h3,{id:"cli",children:"CLI"}),"\n",(0,s.jsx)(n.p,{children:"The command-line interface provides a way to run Velvet pipelines directly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"velvet run {stage} {optional-pipe} \\\n  --config ./path/to/velvet-config.json \\\n  --input-dir ./path/to/input-dir \\\n  --output-dir ./path/to/output-dir\n"})}),"\n",(0,s.jsx)(n.p,{children:"The CLI is primarily used for development, testing, and debugging. In production, Velvet is invoked programmatically from the backend services."}),"\n",(0,s.jsx)(n.h3,{id:"tests",children:"Tests"}),"\n",(0,s.jsx)(n.p,{children:"Velvet includes comprehensive test coverage:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unit tests"})," - Test individual functions and components (e.g., ",(0,s.jsx)(n.code,{children:"irv_unit_tests.rs"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Integration tests"})," - Test complete tallying workflows (e.g., ",(0,s.jsx)(n.code,{children:"irv_integration_tests.rs"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pipe tests"})," - Test individual pipes in isolation"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Tests can be run with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cargo test\n"})}),"\n",(0,s.jsx)(n.h3,{id:"benchmarks",children:"Benchmarks"}),"\n",(0,s.jsx)(n.p,{children:"Performance benchmarks are included to measure and optimize critical operations like PDF generation. Benchmarks use the Criterion framework and can be run with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cargo bench\n"})}),"\n",(0,s.jsx)(n.h2,{id:"workflow",children:"Workflow"}),"\n",(0,s.jsx)(n.p,{children:"A typical Velvet execution flow:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Input"})," - Election configuration and encrypted ballots are provided"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Decode"})," - Ballots are decrypted and decoded"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tally"})," - The counting algorithm processes the ballots"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aggregate"})," - Results from different areas/districts are combined"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Mark Winners"})," - Winning candidates are determined"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Generate Reports"})," - PDF and CSV reports are created"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Output"})," - Results are stored and made available"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"integration-with-admin-portal",children:"Integration with Admin Portal"}),"\n",(0,s.jsx)(n.p,{children:'When an election administrator clicks "Execute Tally" in the Admin Portal:'}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The Admin Portal sends a request to the backend service (Windmill)"}),"\n",(0,s.jsx)(n.li,{children:"Windmill prepares the input data and configuration"}),"\n",(0,s.jsx)(n.li,{children:"Velvet is invoked as a library to process the tally"}),"\n",(0,s.jsx)(n.li,{children:"Results are stored in the database"}),"\n",(0,s.jsx)(n.li,{children:"Reports and receipts are generated"}),"\n",(0,s.jsx)(n.li,{children:"The Admin Portal displays the results"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This integration allows for secure, auditable, and verifiable election tallying within the platform."}),"\n",(0,s.jsx)(n.h2,{id:"design-documentation",children:"Design Documentation"}),"\n",(0,s.jsxs)(n.p,{children:["For more detailed design information, see the ",(0,s.jsx)(n.a,{href:"https://github.com/sequentech/step/blob/main/docs/design/velvet/README.md",children:"Velvet design document"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"package-location",children:"Package Location"}),"\n",(0,s.jsxs)(n.p,{children:["Velvet is located at: ",(0,s.jsx)(n.code,{children:"/packages/velvet/"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var t=i(6540);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);
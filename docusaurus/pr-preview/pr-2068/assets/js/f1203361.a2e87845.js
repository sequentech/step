"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3715],{7312:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"developers/Velvet/velvet_tests","title":"Testing","description":"\x3c!--","source":"@site/docs/developers/07-Velvet/07-tests.md","sourceDirName":"developers/07-Velvet","slug":"/developers/Velvet/velvet_tests","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_tests","draft":false,"unlisted":false,"editUrl":"https://github.com/sequentech/step/edit/main/docs/docusaurus/docs/developers/07-Velvet/07-tests.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"velvet_tests","title":"Testing","sidebar_position":7},"sidebar":"docs","previous":{"title":"Command Line Interface","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_cli"},"next":{"title":"Benchmarks","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_benchmarks"}}');var i=t(4848),l=t(8453);const r={id:"velvet_tests",title:"Testing",sidebar_position:7},d="Testing",a={},c=[{value:"Test Structure",id:"test-structure",level:2},{value:"Running Tests",id:"running-tests",level:2},{value:"All Tests",id:"all-tests",level:3},{value:"Specific Test",id:"specific-test",level:3},{value:"Preserve Test Files",id:"preserve-test-files",level:3},{value:"Test Categories",id:"test-categories",level:2},{value:"Unit Tests",id:"unit-tests",level:3},{value:"Integration Tests",id:"integration-tests",level:3},{value:"Pipe Tests",id:"pipe-tests",level:3},{value:"Writing Tests",id:"writing-tests",level:2},{value:"Unit Test Example",id:"unit-test-example",level:3},{value:"Integration Test Example",id:"integration-test-example",level:3},{value:"Test Fixtures",id:"test-fixtures",level:2},{value:"Test Coverage",id:"test-coverage",level:2},{value:"Continuous Integration",id:"continuous-integration",level:2},{value:"Debugging Tests",id:"debugging-tests",level:2},{value:"Enable Logging",id:"enable-logging",level:3},{value:"Inspect Test Output",id:"inspect-test-output",level:3},{value:"Run with Debugger",id:"run-with-debugger",level:3}];function o(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"testing",children:"Testing"})}),"\n",(0,i.jsx)(s.p,{children:"Velvet includes comprehensive test coverage to ensure correctness and reliability of the tallying system."}),"\n",(0,i.jsx)(s.h2,{id:"test-structure",children:"Test Structure"}),"\n",(0,i.jsxs)(s.p,{children:["Tests are organized in the ",(0,i.jsx)(s.code,{children:"/packages/velvet/tests/"})," directory:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"tests/\n\u251c\u2500\u2500 mod.rs\n\u251c\u2500\u2500 irv_unit_tests.rs\n\u251c\u2500\u2500 irv_integration_tests.rs\n\u2514\u2500\u2500 pipes/\n    \u2514\u2500\u2500 (pipe-specific tests)\n"})}),"\n",(0,i.jsx)(s.h2,{id:"running-tests",children:"Running Tests"}),"\n",(0,i.jsx)(s.h3,{id:"all-tests",children:"All Tests"}),"\n",(0,i.jsx)(s.p,{children:"Run the complete test suite:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cargo test\n"})}),"\n",(0,i.jsx)(s.h3,{id:"specific-test",children:"Specific Test"}),"\n",(0,i.jsx)(s.p,{children:"Run a single test by name:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cargo test -- test_name\n"})}),"\n",(0,i.jsx)(s.p,{children:"Example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cargo test -- cli::test_all::tests::test_hierarchical_area_aggregation\n"})}),"\n",(0,i.jsx)(s.h3,{id:"preserve-test-files",children:"Preserve Test Files"}),"\n",(0,i.jsx)(s.p,{children:"By default, tests clean up generated files. To preserve them for inspection:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"export CLEANUP_FILES=false\ncargo test -- test_name\n"})}),"\n",(0,i.jsx)(s.p,{children:"This is useful when debugging or inspecting intermediate outputs."}),"\n",(0,i.jsx)(s.h2,{id:"test-categories",children:"Test Categories"}),"\n",(0,i.jsx)(s.h3,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,i.jsx)(s.p,{children:"Test individual functions and components in isolation."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Example"}),": ",(0,i.jsx)(s.code,{children:"irv_unit_tests.rs"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Ballot status initialization"}),"\n",(0,i.jsx)(s.li,{children:"Vote redistribution logic"}),"\n",(0,i.jsx)(s.li,{children:"Elimination calculations"}),"\n",(0,i.jsx)(s.li,{children:"Tie-breaking rules"}),"\n",(0,i.jsx)(s.li,{children:"Edge case handling"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,i.jsx)(s.p,{children:"Test complete workflows end-to-end."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Example"}),": ",(0,i.jsx)(s.code,{children:"irv_integration_tests.rs"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Full IRV tallies with multiple rounds"}),"\n",(0,i.jsx)(s.li,{children:"Real-world election scenarios"}),"\n",(0,i.jsx)(s.li,{children:"Complex ballot patterns"}),"\n",(0,i.jsx)(s.li,{children:"Multi-area aggregation"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"pipe-tests",children:"Pipe Tests"}),"\n",(0,i.jsx)(s.p,{children:"Test individual pipes independently:"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Location"}),": ",(0,i.jsx)(s.code,{children:"/packages/velvet/tests/pipes/"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Test each pipe's input/output"}),"\n",(0,i.jsx)(s.li,{children:"Verify data transformations"}),"\n",(0,i.jsx)(s.li,{children:"Check error handling"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"writing-tests",children:"Writing Tests"}),"\n",(0,i.jsx)(s.h3,{id:"unit-test-example",children:"Unit Test Example"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:"#[test]\nfn test_ballot_status_initialization() {\n    let votes = create_test_votes();\n    let contest = create_test_contest();\n    \n    let status = BallotsStatus::initialize_statuses(&votes, &contest);\n    \n    assert_eq!(status.count_valid, expected_valid);\n    assert_eq!(status.count_invalid_votes.explicit, expected_invalid);\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"integration-test-example",children:"Integration Test Example"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'#[test]\nfn test_irv_full_tally() {\n    let tally = create_test_tally();\n    let algorithm = InstantRunoff::new(tally);\n    \n    let result = algorithm.tally().unwrap();\n    \n    assert_eq!(result.candidate_result[0].candidate.id, "winner-id");\n    assert!(result.candidate_result[0].percentage_votes > 50.0);\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"test-fixtures",children:"Test Fixtures"}),"\n",(0,i.jsx)(s.p,{children:"Test data and fixtures are located in:"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Location"}),": ",(0,i.jsx)(s.code,{children:"/packages/velvet/src/fixtures/"})]}),"\n",(0,i.jsx)(s.p,{children:"These fixtures provide:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Sample election configurations"}),"\n",(0,i.jsx)(s.li,{children:"Test ballot data"}),"\n",(0,i.jsx)(s.li,{children:"Expected result sets"}),"\n",(0,i.jsx)(s.li,{children:"Edge case scenarios"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"test-coverage",children:"Test Coverage"}),"\n",(0,i.jsx)(s.p,{children:"Aim to test:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Happy paths"})," - Normal operation"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Edge cases"})," - Boundary conditions"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Error handling"})," - Invalid inputs"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Tie scenarios"})," - Tied votes and eliminations"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Exhausted ballots"})," - Ballots with no remaining choices"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Invalid ballots"})," - Explicit and implicit invalid votes"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Aggregation"})," - Combining results from multiple areas"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"continuous-integration",children:"Continuous Integration"}),"\n",(0,i.jsx)(s.p,{children:"Tests are automatically run as part of the CI/CD pipeline to ensure:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"New code doesn't break existing functionality"}),"\n",(0,i.jsx)(s.li,{children:"All counting algorithms produce correct results"}),"\n",(0,i.jsx)(s.li,{children:"Edge cases are properly handled"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"debugging-tests",children:"Debugging Tests"}),"\n",(0,i.jsx)(s.h3,{id:"enable-logging",children:"Enable Logging"}),"\n",(0,i.jsx)(s.p,{children:"To see detailed logs during tests:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"RUST_LOG=debug cargo test -- --nocapture\n"})}),"\n",(0,i.jsx)(s.h3,{id:"inspect-test-output",children:"Inspect Test Output"}),"\n",(0,i.jsxs)(s.p,{children:["When ",(0,i.jsx)(s.code,{children:"CLEANUP_FILES=false"})," is set, you can inspect:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Generated result files"}),"\n",(0,i.jsx)(s.li,{children:"Intermediate pipe outputs"}),"\n",(0,i.jsx)(s.li,{children:"Log files"}),"\n",(0,i.jsx)(s.li,{children:"Database contents"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"run-with-debugger",children:"Run with Debugger"}),"\n",(0,i.jsx)(s.p,{children:"Use your IDE's debugger or:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"rust-lldb target/debug/deps/velvet-<hash>\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.em,{children:"Further documentation to be added."})})]})}function u(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>r,x:()=>d});var n=t(6540);const i={},l=n.createContext(i);function r(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);
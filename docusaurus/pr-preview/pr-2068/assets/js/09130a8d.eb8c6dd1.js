"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6215],{5533:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"developers/Velvet/velvet_benchmarks","title":"Benchmarks","description":"\x3c!--","source":"@site/docs/developers/07-Velvet/08-benchmarks.md","sourceDirName":"developers/07-Velvet","slug":"/developers/Velvet/velvet_benchmarks","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_benchmarks","draft":false,"unlisted":false,"editUrl":"https://github.com/sequentech/step/edit/main/docs/docusaurus/docs/developers/07-Velvet/08-benchmarks.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"id":"velvet_benchmarks","title":"Benchmarks","sidebar_position":8},"sidebar":"docs","previous":{"title":"Testing","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_tests"},"next":{"title":"Plurality at Large Algorithm","permalink":"/docusaurus/pr-preview/pr-2068/docs/developers/Velvet/velvet_plurality_at_large"}}');var s=r(4848),c=r(8453);const l={id:"velvet_benchmarks",title:"Benchmarks",sidebar_position:8},a="Benchmarks",t={},o=[{value:"Overview",id:"overview",level:2},{value:"Location",id:"location",level:2},{value:"Available Benchmarks",id:"available-benchmarks",level:2},{value:"PDF Generation",id:"pdf-generation",level:3},{value:"Running Benchmarks",id:"running-benchmarks",level:2},{value:"All Benchmarks",id:"all-benchmarks",level:3},{value:"Specific Benchmark",id:"specific-benchmark",level:3},{value:"Understanding Results",id:"understanding-results",level:2},{value:"Benchmark Reports",id:"benchmark-reports",level:2},{value:"Writing Benchmarks",id:"writing-benchmarks",level:2},{value:"Basic Example",id:"basic-example",level:3},{value:"Parameterized Benchmarks",id:"parameterized-benchmarks",level:3},{value:"Performance Targets",id:"performance-targets",level:2},{value:"Optimization Tips",id:"optimization-tips",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Continuous Benchmarking",id:"continuous-benchmarking",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"benchmarks",children:"Benchmarks"})}),"\n",(0,s.jsx)(n.p,{children:"Velvet includes performance benchmarks to measure and optimize critical operations."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Benchmarks help identify performance bottlenecks and track performance improvements over time. They use the ",(0,s.jsx)(n.a,{href:"https://github.com/bheisler/criterion.rs",children:"Criterion"})," benchmarking framework."]}),"\n",(0,s.jsx)(n.h2,{id:"location",children:"Location"}),"\n",(0,s.jsxs)(n.p,{children:["Benchmarks are located in: ",(0,s.jsx)(n.code,{children:"/packages/velvet/benches/"})]}),"\n",(0,s.jsx)(n.h2,{id:"available-benchmarks",children:"Available Benchmarks"}),"\n",(0,s.jsx)(n.h3,{id:"pdf-generation",children:"PDF Generation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"pdf_generation.rs"})]}),"\n",(0,s.jsx)(n.p,{children:"Benchmarks the performance of generating PDF reports from tally results. This is a critical operation as report generation can be time-consuming for large elections."}),"\n",(0,s.jsx)(n.p,{children:"Measures:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PDF rendering time"}),"\n",(0,s.jsx)(n.li,{children:"Memory usage"}),"\n",(0,s.jsx)(n.li,{children:"Throughput for various document sizes"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"running-benchmarks",children:"Running Benchmarks"}),"\n",(0,s.jsx)(n.h3,{id:"all-benchmarks",children:"All Benchmarks"}),"\n",(0,s.jsx)(n.p,{children:"Run all benchmarks:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cargo bench\n"})}),"\n",(0,s.jsx)(n.h3,{id:"specific-benchmark",children:"Specific Benchmark"}),"\n",(0,s.jsx)(n.p,{children:"Run a specific benchmark:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cargo bench --bench pdf_generation\n"})}),"\n",(0,s.jsx)(n.h2,{id:"understanding-results",children:"Understanding Results"}),"\n",(0,s.jsx)(n.p,{children:"Criterion provides detailed statistics:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Mean time"})," - Average execution time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Standard deviation"})," - Variability in measurements"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Median"})," - Middle value of all measurements"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Throughput"})," - Operations per second (when applicable)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pdf_generation/small_report\n                        time:   [45.234 ms 45.789 ms 46.345 ms]\n                        thrpt:  [21.582 ops/s 21.847 ops/s 22.112 ops/s]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"benchmark-reports",children:"Benchmark Reports"}),"\n",(0,s.jsx)(n.p,{children:"Criterion generates HTML reports in:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"target/criterion/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Open ",(0,s.jsx)(n.code,{children:"index.html"})," to see:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Detailed statistics"}),"\n",(0,s.jsx)(n.li,{children:"Performance graphs"}),"\n",(0,s.jsx)(n.li,{children:"Comparisons with previous runs"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"writing-benchmarks",children:"Writing Benchmarks"}),"\n",(0,s.jsx)(n.h3,{id:"basic-example",children:"Basic Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use criterion::{black_box, criterion_group, criterion_main, Criterion};\n\nfn benchmark_function(c: &mut Criterion) {\n    c.bench_function("operation_name", |b| {\n        b.iter(|| {\n            // Code to benchmark\n            expensive_operation(black_box(input_data))\n        });\n    });\n}\n\ncriterion_group!(benches, benchmark_function);\ncriterion_main!(benches);\n'})}),"\n",(0,s.jsx)(n.h3,{id:"parameterized-benchmarks",children:"Parameterized Benchmarks"}),"\n",(0,s.jsx)(n.p,{children:"Test performance across different input sizes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn benchmark_scaling(c: &mut Criterion) {\n    let mut group = c.benchmark_group("scaling");\n    \n    for size in [100, 1000, 10000].iter() {\n        group.bench_with_input(\n            BenchmarkId::from_parameter(size),\n            size,\n            |b, &size| {\n                b.iter(|| process_data(black_box(size)));\n            },\n        );\n    }\n    \n    group.finish();\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"performance-targets",children:"Performance Targets"}),"\n",(0,s.jsx)(n.p,{children:"While specific targets depend on hardware, general goals:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Small elections"})," (< 1,000 votes) - Tally in < 1 second"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Medium elections"})," (1,000-10,000 votes) - Tally in < 5 seconds"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Large elections"})," (10,000-100,000 votes) - Tally in < 30 seconds"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PDF generation"})," - < 100ms per page"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,s.jsx)(n.p,{children:"When optimizing Velvet:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Profile first"})," - Identify actual bottlenecks before optimizing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Benchmark changes"})," - Measure impact of optimizations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consider trade-offs"})," - Balance speed vs. code clarity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Avoid premature optimization"})," - Focus on correctness first"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Benchmark configuration in ",(0,s.jsx)(n.code,{children:"Cargo.toml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[[bench]]\nname = "pdf_generation"\nharness = false\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"harness = false"})," setting tells Cargo to use Criterion's benchmark harness instead of the default."]}),"\n",(0,s.jsx)(n.h2,{id:"continuous-benchmarking",children:"Continuous Benchmarking"}),"\n",(0,s.jsx)(n.p,{children:"Consider running benchmarks:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Before merging performance-related changes"}),"\n",(0,s.jsx)(n.li,{children:"Periodically to track performance trends"}),"\n",(0,s.jsx)(n.li,{children:"When optimizing critical paths"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Further documentation to be added."})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>a});var i=r(6540);const s={},c=i.createContext(s);function l(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);
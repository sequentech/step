"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7310],{4060:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"developers/Tutorials/Load-Testing/load_testing","title":"Load Testing","description":"Introduction","source":"@site/docs/developers/10-Tutorials/02-Load-Testing/load_testing.md","sourceDirName":"developers/10-Tutorials/02-Load-Testing","slug":"/developers/Tutorials/Load-Testing/load_testing","permalink":"/docusaurus/pr-preview/pr-2146/docs/developers/Tutorials/Load-Testing/load_testing","draft":false,"unlisted":false,"editUrl":"https://github.com/sequentech/step/docs/docusaurus/docs/developers/10-Tutorials/02-Load-Testing/load_testing.md","tags":[],"version":"current","frontMatter":{"id":"load_testing","title":"Load Testing"},"sidebar":"docs","previous":{"title":"Add a New Language","permalink":"/docusaurus/pr-preview/pr-2146/docs/developers/Tutorials/add_new_language"},"next":{"title":"Reference Overview","permalink":"/docusaurus/pr-preview/pr-2146/docs/reference/reference"}}');var i=t(4848),l=t(8453);const o={id:"load_testing",title:"Load Testing"},a=void 0,r={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Creating an election",id:"creating-an-election",level:2},{value:"Duplicating votes",id:"duplicating-votes",level:2},{value:"1. Access and Configuration",id:"1-access-and-configuration",level:3},{value:"2. Executing the <code>load-tool</code> script to duplicate votes",id:"2-executing-the-load-tool-script-to-duplicate-votes",level:3},{value:"Environment variables required for duplicate votes",id:"environment-variables-required-for-duplicate-votes",level:4},{value:"duplicate-votes arguments",id:"duplicate-votes-arguments",level:4},{value:"Cast votes using chromium headless",id:"cast-votes-using-chromium-headless",level:2},{value:"1. Executing the <code>vote-cast</code> command to perform vote loading tests",id:"1-executing-the-vote-cast-command-to-perform-vote-loading-tests",level:3},{value:"Managing an election event through the <code>step-cli</code>",id:"managing-an-election-event-through-the-step-cli",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"This tutorial will allow you to create an election with 1M voters, cast 1K votes\nusing a headless chrome web browser and then duplicate votes faster using the\nstep cli."}),"\n",(0,i.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsx)(n.p,{children:"You need:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Basic knowledge of command line terminal usage."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/",children:"Kubectl installed"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/",children:"kubeconfig file"})," that gives access to the cluster. We'll assume\nit's in ",(0,i.jsx)(n.code,{children:"~/.kube/prod1-euw1-kubeconfig.yml"})," throughout the tutorial."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"creating-an-election",children:"Creating an election"}),"\n",(0,i.jsx)(n.h2,{id:"duplicating-votes",children:"Duplicating votes"}),"\n",(0,i.jsx)(n.h3,{id:"1-access-and-configuration",children:"1. Access and Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["First we will set the path to the kubeconfig file so that we can use it for all\nour ",(0,i.jsx)(n.code,{children:"kubectl"})," plugins:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export KUBECONFIG=~/.kube/prod1-euw1-kubeconfig.yml\n"})}),"\n",(0,i.jsx)(n.p,{children:"Let's review the loadtesting pod using the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n test-apps -l app.kubernetes.io/name=loadtesting\n"})}),"\n",(0,i.jsx)(n.p,{children:"The output should looks something like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"NAME                           READY   STATUS    RESTARTS   AGE\nloadtesting-86c5944494-j7gnq   1/1     Running   0          4d21h\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Please note that we are filtering for pods in ",(0,i.jsx)(n.code,{children:"test-apps"})," namespace. Change this\naccordingly to the name of your environment. For example, the ",(0,i.jsx)(n.code,{children:"ehu"})," environment\nwould require to use here the ",(0,i.jsx)(n.code,{children:"ehu-apps"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"We can connect to any of these loadtesting pods using the following kind of\ncommand. Please change the pod name and the namespace name accordingly:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh --help\nUsage: /entrypoint.sh <subcommand> [options]\nSubcommands:\n  load-tool    Run the load-tool tool\n  vote-cast    Run vote casting load tests [--voting-url <value>]\n  shell        Start an interactive shell\n  sleep        Sleeps for an infinite amount of time\n  step-cli     Run step-cli\n\nFor vote-cast subcommand:\n  --voting-url <value>    Voting URL (falls back to $VOTING_URL or $LOADTESTING_VOTING_URL if not provided)\n  Other options are forwarded to /run_bg_voting.sh (e.g. --batches, --instances, --save-screenshots, --env chrome)\n"})}),"\n",(0,i.jsx)(n.p,{children:"With this command, you can check what load testing actions and commands are available."}),"\n",(0,i.jsxs)(n.h3,{id:"2-executing-the-load-tool-script-to-duplicate-votes",children:["2. Executing the ",(0,i.jsx)(n.code,{children:"load-tool"})," script to duplicate votes"]}),"\n",(0,i.jsxs)(n.p,{children:["We can check what ",(0,i.jsx)(n.code,{children:"load-tool"})," options are available by running the entrypoint:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh load-tool --help\nusage: load_tool.py [-h] [--working-directory WORKING_DIRECTORY] {generate-voters,duplicate-votes,generate-applications,generate-activity-logs} ...\n\nLoad Testing Tool\n\npositional arguments:\n  {generate-voters,duplicate-votes,generate-applications,generate-activity-logs}\n                        Action to perform\n    generate-voters     Generate random voters CSV file\n    duplicate-votes     Duplicate cast votes in the database\n    generate-applications\n                        Generate applications in different states\n    generate-activity-logs\n                        Generate activity logs\n\noptions:\n  -h, --help            show this help message and exit\n  --working-directory WORKING_DIRECTORY\n                        Path to working directory (input/output directory)\n"})}),"\n",(0,i.jsx)(n.p,{children:"At this stage we are assuming we have:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"The election event created."}),"\n",(0,i.jsx)(n.li,{children:"The Keys ceremony has been executed."}),"\n",(0,i.jsx)(n.li,{children:"The election event has been published."}),"\n",(0,i.jsx)(n.li,{children:"The eligible voters have been loaded and there's enough voters to add more\nvotes."}),"\n",(0,i.jsx)(n.li,{children:"The voting period is open, so votes can be cast."}),"\n",(0,i.jsx)(n.li,{children:"There's at least one vote cast."}),"\n",(0,i.jsx)(n.li,{children:"The election allows revoting, because the votes are added randomly and\notherwise in some cases more than 1 vote might be added for a single voter."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Given the above, we can just duplicate votes with a command like below, please\nchange the election event id accordingly:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh \\\n    load-tool duplicate-votes \\\n\t--num-votes 10 \\\n\t--election-event-id 7d7f840a-4e75-4ba4-b431-633196da1a2c\n"})}),"\n",(0,i.jsx)(n.p,{children:"The election event id can be found in the admin portal in the URL of the\nelection event."}),"\n",(0,i.jsx)(n.h4,{id:"environment-variables-required-for-duplicate-votes",children:"Environment variables required for duplicate votes"}),"\n",(0,i.jsx)(n.p,{children:"The duplicate-votes action connects to two PostgreSQL databases (Keycloak and Hasura). Connection parameters are read from environment variables inside the loadtesting container. Ensure these are set in the Deployment (typically via Secrets/ConfigMaps) for the loadtesting pod:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Keycloak DB"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"KEYCLOAK_DB__DBNAME"}),"\n",(0,i.jsx)(n.li,{children:"KEYCLOAK_DB__USER"}),"\n",(0,i.jsx)(n.li,{children:"KEYCLOAK_DB__PASSWORD"}),"\n",(0,i.jsx)(n.li,{children:"KEYCLOAK_DB__HOST"}),"\n",(0,i.jsx)(n.li,{children:"KEYCLOAK_DB__PORT"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Hasura DB"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"HASURA_DB__DBNAME"}),"\n",(0,i.jsx)(n.li,{children:"HASURA_DB__USER"}),"\n",(0,i.jsx)(n.li,{children:"HASURA_DB__PASSWORD"}),"\n",(0,i.jsx)(n.li,{children:"HASURA_DB__HOST"}),"\n",(0,i.jsx)(n.li,{children:"HASURA_DB__PORT"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You can quickly verify that these variables are present in the running pod:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it deployment/loadtesting -n test-apps -- env | grep -E '^(KEYCLOAK_DB__|HASURA_DB__)'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note: If any are missing or incorrect, update the loadtesting Deployment (or its referenced Secret/ConfigMap) and redeploy so the pod picks them up."}),"\n",(0,i.jsx)(n.h4,{id:"duplicate-votes-arguments",children:"duplicate-votes arguments"}),"\n",(0,i.jsx)(n.p,{children:"The duplicate-votes subcommand accepts the following arguments:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["--num-votes ",(0,i.jsx)(n.code,{children:"<int>"})," (required)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Number of votes to insert by duplicating existing votes."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["--election-event-id ",(0,i.jsx)(n.code,{children:"<uuid>"})," (required)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The Election Event ID the votes belong to."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["--election-id ",(0,i.jsx)(n.code,{children:"<uuid>"})," (optional)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If omitted, the tool discovers an election_id with at least one existing vote in the event and uses that."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["--tenant-id ",(0,i.jsx)(n.code,{children:"<uuid>"})," (optional; default: 90505c8a-23a9-4cdf-a26b-4e19f6a097d5)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Used to build the Keycloak realm name as ",(0,i.jsx)(n.code,{children:"tenant-{tenant_id}-event-{election_event_id}"})," for querying eligible voters."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Operational notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The tool will:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Find an existing vote for the given election event (and election if specified) to use as a base template."}),"\n",(0,i.jsx)(n.li,{children:"Determine the area_id and election_id (if not passed)."}),"\n",(0,i.jsx)(n.li,{children:"Fetch up to --num-votes random eligible voter IDs from Keycloak for that area."}),"\n",(0,i.jsx)(n.li,{children:"Duplicate existing cast_vote rows, reassigning voter_id_string to the fetched users, and bulk-insert via COPY for speed."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"The election should allow revoting to avoid collisions, since random users may already have cast a vote."}),"\n",(0,i.jsx)(n.li,{children:"There must already be at least one cast vote in the target election/area to serve as the duplication template."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Please find below a short video that shows how we:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Enter the Dashboard of the Election Event, which currently has 400K voters\nand 12 votes cast today and 566 votes in total."}),"\n",(0,i.jsx)(n.li,{children:"Copy the election event id from the Admin Portal URL."}),"\n",(0,i.jsxs)(n.li,{children:["Execute the ",(0,i.jsx)(n.code,{children:"duplicate-votes"})," subcommand adding 10 votes."]}),"\n",(0,i.jsx)(n.li,{children:"Show in the Dashboard that 10 votes have been added, having now 22 votes\ncast today and 576 in total."}),"\n"]}),"\n",(0,i.jsxs)("video",{controls:!0,width:"600",children:[(0,i.jsx)("source",{src:"./assets/duplicate_votes_usage.mp4",type:"video/mp4"}),(0,i.jsx)(n.p,{children:"Your browser does not support the video tag."})]}),"\n",(0,i.jsx)(n.h2,{id:"cast-votes-using-chromium-headless",children:"Cast votes using chromium headless"}),"\n",(0,i.jsxs)(n.h3,{id:"1-executing-the-vote-cast-command-to-perform-vote-loading-tests",children:["1. Executing the ",(0,i.jsx)(n.code,{children:"vote-cast"})," command to perform vote loading tests"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"vote-cast"})," subcommand drives a Nightwatch-based browser test inside the loadtesting pod to cast votes through the public voting UI."]}),"\n",(0,i.jsx)(n.p,{children:"How it works (pipeline):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/entrypoint.sh vote-cast"})," forwards arguments to ",(0,i.jsx)(n.code,{children:"/run_bg_voting.sh"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/run_bg_voting.sh"})," orchestrates parallel Nightwatch runs using the base test at ",(0,i.jsx)(n.code,{children:"/nightwatch/src/voting.js"})," by default."]}),"\n",(0,i.jsxs)(n.li,{children:["Nightwatch runs headlessly by default (env ",(0,i.jsx)(n.code,{children:"default"}),"); you can switch to non-headless with ",(0,i.jsx)(n.code,{children:"--env chrome"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Key flags and environment variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--voting-url <URL>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The voting login URL. If omitted, the script uses ",(0,i.jsx)(n.code,{children:"$VOTING_URL"})," or ",(0,i.jsx)(n.code,{children:"$LOADTESTING_VOTING_URL"})," if set in the pod."]}),"\n",(0,i.jsx)(n.li,{children:"Always quote the URL."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--batches <N>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Total iterations each Nightwatch instance will perform. This maps 1:1 to ",(0,i.jsx)(n.code,{children:"NUMBER_OF_ITERATIONS"})," consumed by ",(0,i.jsx)(n.code,{children:"nightwatch/src/voting.js"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--instances <N>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Parallelism. The orchestrator duplicates the base test into N files and runs them concurrently using Nightwatch workers."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--save-screenshots <true|false>"})," (default: ",(0,i.jsx)(n.code,{children:"false"}),")","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"true"}),", screenshots are saved during the flow."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--number-of-voters <N>"})," (default: ",(0,i.jsx)(n.code,{children:"4096"}),")","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Used by the test to randomize test users."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--username-pattern <pattern>"})," (default: ",(0,i.jsx)(n.code,{children:"user{n}"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--password-pattern <pattern>"})," (default: ",(0,i.jsx)(n.code,{children:"user{n}"}),")","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{n}"})," is replaced by the randomized user index."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--env <default|chrome>"})," (default: ",(0,i.jsx)(n.code,{children:"default"}),")","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Nightwatch environment. ",(0,i.jsx)(n.code,{children:"default"})," runs Chrome headless; ",(0,i.jsx)(n.code,{children:"chrome"})," is non-headless (not recommended in pods)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--disable-voter-tracking"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Disables the anti-double-voting mechanism. When disabled, the same voter can be randomly selected multiple times across iterations. ",(0,i.jsx)(n.strong,{children:"Note"}),": If the election does not allow revoting, tests will fail when a voter is reused. By default, voter tracking is ",(0,i.jsx)(n.strong,{children:"enabled"})," to ensure each voter is used only once per test run."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--previous-voters-file <path>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Path to a ",(0,i.jsx)(n.code,{children:"used_voters.txt"})," file from a previous test run. Voters listed in this file will be excluded from the current run. Useful for chaining multiple test runs or coordinating distributed load testing across multiple machines without voter overlap."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Advanced:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--base-test <relative_path>"})," (default: ",(0,i.jsx)(n.code,{children:"nightwatch/src/voting.js"}),")","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Allows running another test file, e.g., ",(0,i.jsx)(n.code,{children:"nightwatch/src/voting2.js"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--keep-parallel-files"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Keeps the generated duplicate test files and the ",(0,i.jsx)(n.code,{children:"used_voters.txt"})," tracking file under ",(0,i.jsx)(n.code,{children:"/nightwatch/src/_parallel_<RUN_ID>"})," for inspection. By default, these are cleaned up after the test completes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--voter-min-index"})," (default: ",(0,i.jsx)(n.code,{children:"1"}),")","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ids for the voters will be selected between ",(0,i.jsx)(n.code,{children:"voter-min-index"})," and ",(0,i.jsx)(n.code,{children:"voter-min-index + number-of-voters - 1"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--candidates-pattern <regex>"})," (default: empty)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Regular expression to filter candidates by name. Supports JavaScript regex format like ",(0,i.jsx)(n.code,{children:"/^(?!.*text).*$/"})," to exclude candidates containing specific text."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Outputs and logs:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Aggregated Nightwatch log: ",(0,i.jsx)(n.code,{children:"/logs/nightwatch_<timestamp>.log"})," (inside the container)."]}),"\n",(0,i.jsxs)(n.li,{children:["Screenshots (when enabled): ",(0,i.jsx)(n.code,{children:"/nightwatch/screenshots"})," in the container."]}),"\n",(0,i.jsxs)(n.li,{children:["Temporary per-run test copies: ",(0,i.jsx)(n.code,{children:"/nightwatch/src/_parallel_<timestamp>_PID"})," (removed by default unless ",(0,i.jsx)(n.code,{children:"--keep-parallel-files"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Examples:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Single instance, single iteration (sanity check):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh \\\n  vote-cast \\\n  --voting-url "https://voting-test.sequent.vote/tenant/90505c8a-23a9-4cdf-a26b-4e19f6a097d5/event/7d7f840a-4e75-4ba4-b431-633196da1a2c/login" \\\n  --batches 1 \\\n  --instances 1\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"8 instances in parallel, 200 iterations each:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh \\\n  vote-cast \\\n  --voting-url "https://voting-test.sequent.vote/tenant/90505c8a-23a9-4cdf-a26b-4e19f6a097d5/event/7d7f840a-4e75-4ba4-b431-633196da1a2c/login" \\\n  --batches 200 \\\n  --instances 8 \\\n  --save-screenshots false\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Debugging with non-headless Chrome (use sparingly; pods may not support it):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh \\\n  vote-cast \\\n  --voting-url "https://voting-test.sequent.vote/tenant/90505c8a-23a9-4cdf-a26b-4e19f6a097d5/event/7d7f840a-4e75-4ba4-b431-633196da1a2c/login" \\\n  --batches 1 \\\n  --instances 1 \\\n  --env chrome \\\n  --save-screenshots true\n'})}),"\n",(0,i.jsx)(n.p,{children:"Troubleshooting:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If your run prints defaults (e.g., ",(0,i.jsx)(n.code,{children:"INSTANCES: 4"})," or ",(0,i.jsx)(n.code,{children:"ITERATIONS: 10"}),") despite passing flags, ensure the flags follow ",(0,i.jsx)(n.code,{children:"vote-cast"})," and that the URL is quoted."]}),"\n",(0,i.jsxs)(n.li,{children:["If the site markup requires different selectors, consider providing an alternative base test via ",(0,i.jsx)(n.code,{children:"--base-test nightwatch/src/voting2.js"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["To keep the generated parallel files for inspection, add ",(0,i.jsx)(n.code,{children:"--keep-parallel-files"})," and check ",(0,i.jsx)(n.code,{children:"/nightwatch/src/_parallel_*"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"managing-an-election-event-through-the-step-cli",children:["Managing an election event through the ",(0,i.jsx)(n.code,{children:"step-cli"})]}),"\n",(0,i.jsxs)(n.p,{children:["You can check what options are available to you by calling the ",(0,i.jsx)(n.code,{children:"step-cli"})," CLI tool:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh step-cli step --help\nUsage: step-cli step <COMMAND>\n\nCommands:\n  config                        Create a config file\n  create-election-event         Create a new election event\n  create-election               Create a new election\n  create-contest                Create a new contest\n  create-candidate              Create a new candidate\n  create-area                   Create a new area\n  create-area-contest           Create area contest\n  create-voter                  Create a new voter\n  export-cast-votes             Export a cast vote\n  update-voter                  Edit a voter\n  update-election-event-status  Update election event status\n  update-election-status        Update election status\n  import-election               Import Election Event\n  publish                       Publish election event ballot changes\n  refresh-token                 Refresh auth jwt\n  start-key-ceremony            Start Key Ceremony\n  complete-key-ceremony         Complete Key Ceremony\n  start-tally                   Start Tally Ceremony\n  update-tally                  Update tally status\n  confirm-key-tally             Confirm trustee key for tally ceremony\n  render-template               Render a handlebars-rs template with variables\n  generate-voters\n  duplicate-votes\n  create-applications\n  create-electoral-logs\n  hash-password                 Process a CSV file to hash passwords and generate salts\n  help                          Print this message or the help of the given subcommand(s)\n\nOptions:\n  -h, --help  Print help\n"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},l=s.createContext(i);function o(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);
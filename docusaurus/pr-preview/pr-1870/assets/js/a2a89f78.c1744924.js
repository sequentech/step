"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[357],{5440:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>r});const o=JSON.parse('{"id":"cli/Tutorials/Load-Testing/load_testing","title":"Load Testing","description":"Introduction","source":"@site/docs/cli/Tutorials/Load-Testing/load_testing.md","sourceDirName":"cli/Tutorials/Load-Testing","slug":"/cli/Tutorials/Load-Testing/load_testing","permalink":"/docusaurus/pr-preview/pr-1870/docs/cli/Tutorials/Load-Testing/load_testing","draft":false,"unlisted":false,"editUrl":"https://github.com/sequentech/step/docs/docusaurus/docs/cli/Tutorials/Load-Testing/load_testing.md","tags":[],"version":"current","frontMatter":{"id":"load_testing","title":"Load Testing"},"sidebar":"docs","previous":{"title":"Braid Trustees Configuration","permalink":"/docusaurus/pr-preview/pr-1870/docs/developers/Braid/braid_trustees_configuration"},"next":{"title":"Reference Overview","permalink":"/docusaurus/pr-preview/pr-1870/docs/reference/"}}');var s=n(4848),a=n(8453);const i={id:"load_testing",title:"Load Testing"},l=void 0,c={},r=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Creating an election",id:"creating-an-election",level:2},{value:"Cast votes using chromium headless",id:"cast-votes-using-chromium-headless",level:2},{value:"Duplicating votes",id:"duplicating-votes",level:2},{value:"1. Access and Configuration",id:"1-access-and-configuration",level:3},{value:"2. Executing the <code>load-tool</code> script to duplicate votes",id:"2-executing-the-load-tool-script-to-duplicate-votes",level:3},{value:"2. Executing the <code>vote-cast</code> command to perform vote loading tests",id:"2-executing-the-vote-cast-command-to-perform-vote-loading-tests",level:3},{value:"3. Executing the <code>tally</code> load test",id:"3-executing-the-tally-load-test",level:3}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(t.p,{children:"This tutorial will allow you to create an election with 1M voters, cast 1K votes\nusing a headless chrome web browser and then duplicate votes faster using the\nstep cli."}),"\n",(0,s.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsx)(t.p,{children:"You need:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Basic knowledge of command line terminal usage."}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/",children:"Kubectl installed"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["A ",(0,s.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/",children:"kubeconfig file"})," that gives access to the cluster. We'll assume\nit's in ",(0,s.jsx)(t.code,{children:"~/.kube/prod1-euw1-kubeconfig.yml"})," throughout the tutorial."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"creating-an-election",children:"Creating an election"}),"\n",(0,s.jsx)(t.h2,{id:"cast-votes-using-chromium-headless",children:"Cast votes using chromium headless"}),"\n",(0,s.jsx)(t.h2,{id:"duplicating-votes",children:"Duplicating votes"}),"\n",(0,s.jsx)(t.h3,{id:"1-access-and-configuration",children:"1. Access and Configuration"}),"\n",(0,s.jsxs)(t.p,{children:["First we will set the path to the kubeconfig file so that we can use it for all\nour ",(0,s.jsx)(t.code,{children:"kubectl"})," plugins:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"export KUBECONFIG=~/.kube/prod1-euw1-kubeconfig.yml\n"})}),"\n",(0,s.jsx)(t.p,{children:"Let's review the loadtesting pod using the following command:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"kubectl get pods -n test-apps -l app.kubernetes.io/name=loadtesting\n"})}),"\n",(0,s.jsx)(t.p,{children:"The output should looks something like:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"NAME                           READY   STATUS    RESTARTS   AGE\nloadtesting-86c5944494-j7gnq   1/1     Running   0          4d21h\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Please note that we are filtering for pods in ",(0,s.jsx)(t.code,{children:"test-apps"})," namespace. Change this\naccordingly to the name of your environment. For example, the ",(0,s.jsx)(t.code,{children:"ehu"})," environment\nwould require to use here the ",(0,s.jsx)(t.code,{children:"ehu-apps"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"We can connect to any of these loadtesting pods using the following kind of\ncommand. Please change the pod name and the namespace name accordingly:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh --help\nUsage: /entrypoint.sh <subcommand> [options]\nSubcommands:\n  load-tool    Run the load-tool tool\n  vote-cast    Run vote casting load tests [--voting-url <value>]\n  shell        Start an interactive shell\n  sleep        Sleeps for an infinite amount of time\n  step-cli     Run step-cli\n\nFor vote-cast subcommand:\n  --voting-url <value>    Voting URL (falls back to $LOADTESTING_VOTING_URL if not provided)\n"})}),"\n",(0,s.jsx)(t.p,{children:"With this command, you can check what load testing actions and commands are available."}),"\n",(0,s.jsxs)(t.h3,{id:"2-executing-the-load-tool-script-to-duplicate-votes",children:["2. Executing the ",(0,s.jsx)(t.code,{children:"load-tool"})," script to duplicate votes"]}),"\n",(0,s.jsxs)(t.p,{children:["We can check what ",(0,s.jsx)(t.code,{children:"load-tool"})," options are available by running the entrypoint:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh load-tool --help\nusage: load_tool.py [-h] [--working-directory WORKING_DIRECTORY] {generate-voters,duplicate-votes,generate-applications,generate-activity-logs} ...\n\nLoad Testing Tool\n\npositional arguments:\n  {generate-voters,duplicate-votes,generate-applications,generate-activity-logs}\n                        Action to perform\n    generate-voters     Generate random voters CSV file\n    duplicate-votes     Duplicate cast votes in the database\n    generate-applications\n                        Generate applications in different states\n    generate-activity-logs\n                        Generate activity logs\n\noptions:\n  -h, --help            show this help message and exit\n  --working-directory WORKING_DIRECTORY\n                        Path to working directory (input/output directory)\n"})}),"\n",(0,s.jsx)(t.p,{children:"At this stage we are assuming we have:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"The election event created."}),"\n",(0,s.jsx)(t.li,{children:"The Keys ceremony has been executed."}),"\n",(0,s.jsx)(t.li,{children:"The election event has been published."}),"\n",(0,s.jsx)(t.li,{children:"The eligible voters have been loaded and there's enough voters to add more\nvotes."}),"\n",(0,s.jsx)(t.li,{children:"The voting period is open, so votes can be cast."}),"\n",(0,s.jsx)(t.li,{children:"There's at least one vote cast."}),"\n",(0,s.jsx)(t.li,{children:"The election allows revoting, because the votes are added randomly and\notherwise in some cases more than 1 vote might be added for a single voter."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Given the above, we can just duplicate votes with a command like below, please\nchange the election event id accordingly:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh \\\n    load-tool duplicate-votes \\\n\t--num-votes 10 \\\n\t--election-event-id 7d7f840a-4e75-4ba4-b431-633196da1a2c\n"})}),"\n",(0,s.jsx)(t.p,{children:"The election event id can be found in the admin portal in the URL of the\nelection event."}),"\n",(0,s.jsx)(t.p,{children:"Please find below a short video that shows how we:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Enter the Dashboard of the Election Event, which currently has 400K voters\nand 12 votes cast today and 566 votes in total."}),"\n",(0,s.jsx)(t.li,{children:"Copy the election event id from the Admin Portal URL."}),"\n",(0,s.jsxs)(t.li,{children:["Execute the ",(0,s.jsx)(t.code,{children:"duplicate-votes"})," subcommand adding 10 votes."]}),"\n",(0,s.jsx)(t.li,{children:"Show in the Dashboard that 10 votes have been added, having now 22 votes\ncast today and 576 in total."}),"\n"]}),"\n",(0,s.jsxs)("video",{controls:!0,width:"600",children:[(0,s.jsx)("source",{src:"./assets/duplicate_votes_usage.mp4",type:"video/mp4"}),(0,s.jsx)(t.p,{children:"Your browser does not support the video tag."})]}),"\n",(0,s.jsxs)(t.h3,{id:"2-executing-the-vote-cast-command-to-perform-vote-loading-tests",children:["2. Executing the ",(0,s.jsx)(t.code,{children:"vote-cast"})," command to perform vote loading tests"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh \\\n    vote-cast \\\n\t--voting-url https://voting-test.sequent.vote/tenant/90505c8a-23a9-4cdf-a26b-4e19f6a097d5/event/7d7f840a-4e75-4ba4-b431-633196da1a2c/login\n"})}),"\n",(0,s.jsxs)(t.h3,{id:"3-executing-the-tally-load-test",children:["3. Executing the ",(0,s.jsx)(t.code,{children:"tally"})," load test"]}),"\n",(0,s.jsxs)(t.p,{children:["You can check what options are available to you by calling the ",(0,s.jsx)(t.code,{children:"step-cli"})," CLI tool:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ kubectl exec -it deployment/loadtesting -n test-apps -- /entrypoint.sh step-cli step --help\nUsage: step-cli step <COMMAND>\n\nCommands:\n  config                        Create a config file\n  create-election-event         Create a new election event\n  create-election               Create a new election\n  create-contest                Create a new contest\n  create-candidate              Create a new candidate\n  create-area                   Create a new area\n  create-area-contest           Create area contest\n  create-voter                  Create a new voter\n  export-cast-votes             Export casted a vote\n  update-voter                  Edit a voter\n  update-election-event-status  Update election event status\n  update-election-status        Update election status\n  import-election               Import Election Event\n  publish                       Publish election event ballot changes\n  refresh-token                 Refresh auth jwt\n  start-key-ceremony            Start Key Ceremony\n  complete-key-ceremony         Complete Key Ceremony\n  start-tally                   Start Tally Ceremony\n  update-tally                  Update tally status\n  confirm-key-tally             Confirm trustee key for tally ceremony\n  render-template               Render a handlebars-rs template with variables\n  generate-voters\n  duplicate-votes\n  create-applications\n  create-electoral-logs\n  hash-password                 Process a CSV file to hash passwords and generate salts\n  help                          Print this message or the help of the given subcommand(s)\n\nOptions:\n  -h, --help  Print help\n"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>l});var o=n(6540);const s={},a=o.createContext(s);function i(e){const t=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);
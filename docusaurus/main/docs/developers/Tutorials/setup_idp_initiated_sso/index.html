<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-developers/Tutorials/setup_idp_initiated_sso" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">IdP SSO Configuration &amp; Handoff | Sequent Online Voting</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/docusaurus/main/docs/developers/Tutorials/setup_idp_initiated_sso"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="IdP SSO Configuration &amp; Handoff | Sequent Online Voting"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/docusaurus/main/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/docusaurus/main/docs/developers/Tutorials/setup_idp_initiated_sso"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docusaurus/main/docs/developers/Tutorials/setup_idp_initiated_sso" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docusaurus/main/docs/developers/Tutorials/setup_idp_initiated_sso" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"IdP SSO Configuration & Handoff","item":"https://your-docusaurus-site.example.com/docusaurus/main/docs/developers/Tutorials/setup_idp_initiated_sso"}]}</script><link rel="stylesheet" href="/docusaurus/main/assets/css/styles.fe236151.css">
<script src="/docusaurus/main/assets/js/runtime~main.f6745013.js" defer="defer"></script>
<script src="/docusaurus/main/assets/js/main.e39e880e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docusaurus/main/img/logo_negative.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus/main/"><div class="navbar__logo"><img src="/docusaurus/main/img/logo_negative.svg" alt="Sequent Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docusaurus/main/img/logo_negative.svg" alt="Sequent Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">    Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docusaurus/main/docs/system_introduction/">Docs</a><a href="/docusaurus/main/graphql" class="navbar__item navbar__link" target="_blank">GraphQL API</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/sequentech" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus/main/docs/system_introduction/">System Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docusaurus/main/docs/releases/Release Next/release-next">Releases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docusaurus/main/docs/admin_portal/election_management">Election Managers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docusaurus/main/docs/voting_portal/voting_portal">Voters</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docusaurus/main/docs/election_auditors/ballot_signature">Election Auditors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docusaurus/main/docs/developers/graphql_api">Developers</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/main/docs/developers/graphql_api">GraphQL API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/CLI/cli">CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/Admin-Portal/developers_admin_portal">Admin Portal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/Voting-Portal/cast_vote_errors">Voting Portal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/Keycloak/developers_keycloak">Keycloak</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/Velvet/developers_velvet">Velvet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/Windmill/developers_windmill">Windmill</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/Braid/braid_trustees_configuration">Braid</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docusaurus/main/docs/developers/Tutorials/add_new_language">Tutorials</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus/main/docs/developers/Tutorials/add_new_language">Add a New Language</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docusaurus/main/docs/developers/Tutorials/Load-Testing/load_testing">Load Testing</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus/main/docs/developers/Tutorials/setup_idp_initiated_sso">IdP SSO Configuration &amp; Handoff</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus/main/docs/reference/reference">Reference</a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docusaurus/main/docs/integrations/idp_initiated_sso_integration_guide">Integrations</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docusaurus/main/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developers</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">IdP SSO Configuration &amp; Handoff</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>IdP SSO Configuration &amp; Handoff</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This guide is for <strong>Sequent delivery team members</strong> responsible for:</p>
<ol>
<li>Configuring the Keycloak Service Provider (SP) for IdP-initiated SSO integrations</li>
<li>Testing the integration before client handoff</li>
<li>Handing off the integration to third-party clients</li>
</ol>
<p><strong>Audience:</strong> Sequent operations, delivery, and support teams</p>
<p><strong>For third-party integrators:</strong> See the <a href="/docusaurus/main/docs/integrations/idp_initiated_sso_integration_guide">IdP-Initiated SSO Integration Guide</a> instead.</p>
<p><strong>For internal developers:</strong> See the <a href="/docusaurus/main/docs/developers/Keycloak/idp_initiated_sso_design_implementation">IdP-Initiated SSO Design &amp; Implementation</a> for technical details.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-this-guide-covers">What This Guide Covers<a href="#what-this-guide-covers" class="hash-link" aria-label="Direct link to What This Guide Covers" title="Direct link to What This Guide Covers">​</a></h3>
<ol>
<li><strong>Keycloak SP configuration</strong> for a new tenant/event</li>
<li><strong>Testing with the SimpleSAMLphp reference implementation</strong> before client handoff</li>
<li><strong>Information package</strong> to provide to third-party integrators</li>
<li><strong>Handoff checklist</strong> to ensure smooth client integration</li>
<li><strong>Troubleshooting</strong> common issues during integration</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-overview">Architecture Overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture Overview" title="Direct link to Architecture Overview">​</a></h3>
<ul>
<li><strong>Third-Party IdP:</strong> Client&#x27;s identity provider (they control this)</li>
<li><strong>Keycloak (SP/Broker):</strong> Sequent-controlled authentication service that receives SAML assertions</li>
<li><strong>Voting Portal:</strong> Target application where users access voting functionality</li>
<li><strong>SimpleSAMLphp Reference:</strong> Testing tool to verify Keycloak configuration before client integration</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<p>Before starting a new IdP-initiated SSO integration:</p>
<ol>
<li>
<p><strong>Tenant and Event Information:</strong></p>
<ul>
<li>Tenant ID (UUID)</li>
<li>Event ID (UUID)</li>
<li>Client organization name (for IdP alias)</li>
</ul>
</li>
<li>
<p><strong>Access to Keycloak Admin Console:</strong></p>
<ul>
<li>Admin credentials for the Keycloak instance</li>
<li>Ability to create/modify realms, identity providers, and clients</li>
</ul>
</li>
<li>
<p><strong>For Testing (Optional but Recommended):</strong></p>
<ul>
<li>Local SimpleSAMLphp instance for pre-handoff testing</li>
<li>Access to the Step repository (<code>.devcontainer/simplesamlphp/</code>)</li>
</ul>
</li>
<li>
<p><strong>Client Information (to be received from third-party):</strong></p>
<ul>
<li>IdP Entity ID</li>
<li>IdP SSO Service URL</li>
<li>IdP public signing certificate (X.509 format)</li>
<li>IdP metadata URL (if available)</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1-initial-keycloak-configuration">Phase 1: Initial Keycloak Configuration<a href="#phase-1-initial-keycloak-configuration" class="hash-link" aria-label="Direct link to Phase 1: Initial Keycloak Configuration" title="Direct link to Phase 1: Initial Keycloak Configuration">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-11-create-or-verify-the-realm">Step 1.1: Create or Verify the Realm<a href="#step-11-create-or-verify-the-realm" class="hash-link" aria-label="Direct link to Step 1.1: Create or Verify the Realm" title="Direct link to Step 1.1: Create or Verify the Realm">​</a></h3>
<p>The realm identifier follows the pattern:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tenant-{TENANT_ID}-event-{EVENT_ID}</span><br></span></code></pre></div></div>
<p><strong>Example:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tenant-90505c8a-23a9-4cdf-a26b-4e19f6a097d5-event-cd1397d3-d236-42b4-a019-49143b616e13</span><br></span></code></pre></div></div>
<p>Typically, this is created automatically for every Election Event. For example,
when you import or create an election event, the url of the election event
contains the election event id, something like:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3002/sequent_backend_election_event/e3329c90-a238-4e45-b480-18a8b5ad64cf</span><br></span></code></pre></div></div>
<p>And also the realm identifier appear in the login link for the election event,
that you can obtain at the bottom of the Admin Portal Dashboard under the Link
<code>Voter Login URL</code>, something like:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:3000/tenant/90505c8a-23a9-4cdf-a26b-4e19f6a097d5/event/e3329c90-a238-4e45-b480-18a8b5ad64cf/login</span><br></span></code></pre></div></div>
<p>Once you have obtained the realm identifier:</p>
<ol>
<li>Log into Keycloak Admin Console</li>
<li>Find the realm in the sidebar under <code>Manage Realms</code> action</li>
</ol>
<p><strong>To export the realm certificate:</strong></p>
<ol>
<li>Go to <strong>Realm Settings</strong> → <strong>Keys</strong> tab</li>
<li>Find the <code>RSA</code> key of use <code>SIG</code></li>
<li>Click <strong>Certificate</strong> button</li>
<li>Copy the certificate (this will be provided to the client as <code>SP_CERT_DATA</code>)</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-12-configure-the-vp-sso-saml-client">Step 1.2: Configure the vp-sso SAML Client<a href="#step-12-configure-the-vp-sso-saml-client" class="hash-link" aria-label="Direct link to Step 1.2: Configure the vp-sso SAML Client" title="Direct link to Step 1.2: Configure the vp-sso SAML Client">​</a></h3>
<p>This client represents the voting portal application. The configuration below is
typically already automatically set up by the default keycloak realm
configuration in Sequent Voting Plataform. However, you can also use the
instructions below to verify everything is correctly configured, or in case the
realm template is misconfigured or old, to configure these settings manually.
<em>Note: The vp-sso client configuration that comes by default at election event creation might be wrong or outdated.
It is recommended to create a new configuration or follow this guide to review it.</em></p>
<ol>
<li>
<p><strong>Navigate:</strong> Go to <strong>Clients</strong> in the realm</p>
</li>
<li>
<p><strong>Create Client:</strong> Click <strong>Create client</strong></p>
</li>
<li>
<p><strong>General Settings:</strong></p>
<ul>
<li><strong>Client type:</strong> SAML</li>
<li><strong>Client ID:</strong> <code>vp-sso</code></li>
<li>Click <strong>Next</strong></li>
</ul>
</li>
<li>
<p><strong>Capability config:</strong> Keep defaults, click <strong>Next</strong></p>
</li>
<li>
<p><strong>Login settings:</strong></p>
<ul>
<li><strong>Root URL:</strong> <code>{VOTING_PORTAL_URL}</code> (e.g., <code>https://voting-{subdomain}.sequentech.io</code>)</li>
<li><strong>Valid redirect URIs:</strong> <code>{VOTING_PORTAL_URL}/*</code></li>
<li><strong>IdP-initiated SSO URL Name:</strong> <code>vp-sso</code></li>
<li><strong>IdP-initiated SSO RelayState:</strong> <code>{VOTING_PORTAL_URL}/tenant/{TENANT_ID}/event/{EVENT_ID}/login</code></li>
</ul>
</li>
<li>
<p><strong>SAML Capabilities:</strong></p>
<ul>
<li><strong>Name ID format:</strong> <code>email</code></li>
<li><strong>Force Name ID format:</strong> <strong>OFF</strong></li>
<li><strong>Force POST binding:</strong> <strong>ON</strong></li>
<li><strong>Include AuthnStatement:</strong> <strong>ON</strong></li>
</ul>
</li>
<li>
<p><strong>Signature and Encryption:</strong></p>
<ul>
<li><strong>Sign Documents:</strong> <strong>ON</strong></li>
<li><strong>Sign Assertions:</strong> <strong>ON</strong></li>
<li><strong>Signature Algorithm:</strong> <code>RSA_SHA256</code></li>
<li><strong>Client signature required:</strong> <strong>OFF</strong> (the voting portal doesn&#x27;t sign requests). Ignore it if this option does not appear.</li>
</ul>
</li>
<li>
<p>Click <strong><code>Save</code></strong></p>
</li>
<li>
<p><strong><code>Advanced</code> Tab:</strong></p>
<ul>
<li><strong>Fine grain SAML endpoint configuration:</strong>
<ul>
<li><strong>Assertion Consumer Service POST Binding URL:</strong> <code>{KEYCLOAK_BASE_URL}/realms/{REALM_ID}/redirect-provider/redirect</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Click <strong><code>Save</code></strong></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-13-prepare-configuration-for-client">Step 1.3: Prepare Configuration for Client<a href="#step-13-prepare-configuration-for-client" class="hash-link" aria-label="Direct link to Step 1.3: Prepare Configuration for Client" title="Direct link to Step 1.3: Prepare Configuration for Client">​</a></h3>
<p>At this point, you have the Keycloak configuration complete. Now prepare the information package for the client.</p>
<p><strong>Configuration values to provide to client:</strong></p>
<table><thead><tr><th>Parameter</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td><code>TENANT_ID</code></td><td>The tenant UUID</td><td><code>abc12345-6789-...</code></td></tr><tr><td><code>EVENT_ID</code></td><td>The event UUID</td><td><code>def67890-1234-...</code></td></tr><tr><td><code>SP_BASE_URL</code></td><td>Keycloak base URL</td><td><code>https://login-example.sequent.vote</code></td></tr><tr><td><code>SP_IDP_ALIAS</code></td><td>IdP alias (decided with client)</td><td><code>clientname-idp</code></td></tr><tr><td><code>SP_CLIENT_ID</code></td><td>SAML client ID</td><td><code>vp-sso</code></td></tr><tr><td><code>SP_CERT_DATA</code></td><td>Keycloak realm certificate</td><td><code>MIIDOzCCAi...</code></td></tr><tr><td><code>VOTING_PORTAL_URL</code></td><td>Voting portal URL</td><td><code>https://voting-example.sequent.vote</code></td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2-test-with-simplesamlphp-reference-implementation">Phase 2: Test with SimpleSAMLphp Reference Implementation<a href="#phase-2-test-with-simplesamlphp-reference-implementation" class="hash-link" aria-label="Direct link to Phase 2: Test with SimpleSAMLphp Reference Implementation" title="Direct link to Phase 2: Test with SimpleSAMLphp Reference Implementation">​</a></h2>
<p>Before handing off to the client, test the Keycloak configuration using the
SimpleSAMLphp reference implementation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-21-set-up-simplesamlphp-locally">Step 2.1: Set Up SimpleSAMLphp Locally<a href="#step-21-set-up-simplesamlphp-locally" class="hash-link" aria-label="Direct link to Step 2.1: Set Up SimpleSAMLphp Locally" title="Direct link to Step 2.1: Set Up SimpleSAMLphp Locally">​</a></h3>
<p>If you are testing this in step repository devcontainer environment, then you
need to edit the environment configuration variables in the <code>.devcontainer/.env</code>
file. Otherwise, you will have to replicate these variables used by the
<code>simplesamlphp</code> sample app, which you can find in
<code>.devcontainer/simplesamlphp/.env.example</code>.
If you are in dev environment edit <code>.devcontainer/.env.development</code> and do not forget to run the vscode task <code>update.env</code> afterwards. Last but not least: do not commit the changes.</p>
<p>We will asume you are using the step repository devcontainer environment.</p>
<ol>
<li>
<p><strong>Edit <code>.devcontainer/.env</code> with your test configuration:</strong></p>
<p>Please ensure you use the data relative to your specific environment. For
example, <code>SP_CERT_DATA</code> was obtained in point 1.1. You will be editing the
section titled <code>SimpleSAMLphp IdP Configuration</code> that starts as it is shown
below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">################################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># SimpleSAMLphp IdP Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># These variables configure the SimpleSAMLphp instance as a reference IdP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># implementation for third-party integrators.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Simple SAML PHP General Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># =============================================================================</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Start SimpleSAMLphp</strong> (using Docker or your preferred method). If you are
testing this with devcontainers, you can run in VSCode the task
<code>logs.restart.simplesamlphp</code>.</p>
</li>
<li>
<p><strong>Login into SimpleSAMLphp application</strong>, it should be an URL like
<code>http://localhost:8083/simplesaml/module.php/admin</code>, in general something
like <code>{IDP_BASE_URL}/module.php/admin</code>. You should get a login page as below:</p>
</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The <code>admin</code> password is setup in the <code>.env</code> file mentioned earlier with the
variable <code>SSP_ADMIN_PASSWORD</code> and it&#x27;s <code>admin</code> by default, but please remember
this is just a sample implementation, use secure passwords in production.</p></div></div>
<p><img decoding="async" loading="lazy" alt="Admin Login" src="/docusaurus/main/assets/images/simplesamlphp_admin_login-00740d654d29485e7477c6869facdcb7.png" width="2312" height="1658" class="img_ev3q"></p>
<p>After login in the SimpleSAMLphp Admin Portal, you should see something like:</p>
<p><img decoding="async" loading="lazy" alt="Admin Portal" src="/docusaurus/main/assets/images/simplesamlphp_admin_portal-89ad8dd80d7d1e3b2ad37949d9e4154e.png" width="2312" height="1658" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-22-configure-keycloak-to-trust-simplesamlphp">Step 2.2: Configure Keycloak to Trust SimpleSAMLphp<a href="#step-22-configure-keycloak-to-trust-simplesamlphp" class="hash-link" aria-label="Direct link to Step 2.2: Configure Keycloak to Trust SimpleSAMLphp" title="Direct link to Step 2.2: Configure Keycloak to Trust SimpleSAMLphp">​</a></h3>
<p>Now configure Keycloak to accept SAML assertions from your local SimpleSAMLphp instance.</p>
<ol>
<li><strong>Navigate to Authentication</strong> in your Keycloak realm</li>
<li><strong>In the flows tab</strong> Click <strong>Create flow</strong>
<ul>
<li><strong>Name:</strong> <code>saml first broker flow</code></li>
<li><strong>Flow type:</strong> Basic flow</li>
</ul>
</li>
<li>Click <strong>Create</strong></li>
<li>Click <strong>Add execution</strong></li>
<li>Search for <code>Detect existing broker user</code> execution and then click <strong>Add</strong></li>
<li>Set the execution to <strong>Required</strong></li>
<li>Click <strong>Add execution</strong></li>
<li>Search for <code>Automatically set existing user</code> execution and then click <strong>Add</strong></li>
<li>Set the execution to <strong>Required</strong></li>
<li><strong>Navigate to Identity Providers</strong> in your Keycloak realm</li>
<li><strong>Add provider:</strong> Click <strong>Add provider</strong> → <strong>SAML v2.0</strong></li>
<li><strong>Configure Identity Provider:</strong></li>
</ol>
<ul>
<li><strong>Alias:</strong> <code>yourcompany-idp</code> (matches <code>SP_IDP_ALIAS</code> from <code>.env</code>). *Note:
It is not possible to edit the Alias, if it already exists, then remove it
and create a new Identity Provider.</li>
<li><strong>Display Name:</strong> <code>SimpleSAMLphp IdP</code></li>
<li><strong>Service provider entity ID:</strong> <code>tenant-{TENANT_ID}-event-{EVENT_ID}</code></li>
</ul>
<ol>
<li><strong>Import SimpleSAMLphp metadata (recommended):</strong></li>
</ol>
<ul>
<li><strong>Use Entity Descriptor</strong>: <strong>OFF</strong></li>
<li>Download <code>http://localhost:8083/simplesaml/saml2/idp/metadata.php</code></li>
<li>Drag and drop the downloaded xml into <strong>Import config from file</strong></li>
<li><strong>Principal Type:</strong> Attribute Name</li>
<li><strong>Principal Attribute:</strong> email</li>
<li><strong>Validate Signatures:</strong> <strong>ON</strong></li>
<li><strong>First login flow override:</strong> saml first broker flow</li>
<li>Click <strong>Add</strong></li>
</ul>
<p><strong>OR manually configure:</strong></p>
<ul>
<li><strong>Use Entity Descriptor</strong>: <strong>OFF</strong></li>
<li><strong>Single Sign-On Service URL:</strong> <code>http://localhost:8083/simplesaml/saml2/idp/SSOService.php</code></li>
<li><strong>Single Logout Service URL:</strong> <code>http://localhost:8083/simplesaml/saml2/idp/SingleLogoutService.php</code></li>
<li><strong>NameID Policy Format:</strong> Transient</li>
<li><strong>Principal Type:</strong> Attribute Name</li>
<li><strong>Principal Attribute:</strong> email</li>
<li><strong>HTTP-POST Binding Response:</strong> <strong>ON</strong></li>
<li><strong>HTTP-POST Binding AuthnRequest:</strong> <strong>ON</strong></li>
<li><strong>Want AuthnRequests Signed:</strong> <strong>ON</strong></li>
<li><strong>Signature Algorithm:</strong> RSA_SHA256</li>
<li><strong>Want Assertions Signed:</strong> <strong>ON</strong></li>
<li><strong>Validate Signatures:</strong> <strong>ON</strong></li>
<li><strong>Validating X509 Certificates:</strong> Paste SimpleSAMLphp&#x27;s public certificate (<code>server.crt</code> content, without BEGIN/END lines)</li>
<li>Click <strong>Add</strong> and scroll to the bottom to find the <code>First login flow override</code> setting.</li>
<li><strong>First login flow override:</strong> saml first broker flow</li>
</ul>
<ol start="2">
<li><strong>Configure Attribute Mapper:</strong></li>
</ol>
<ul>
<li>Go to <strong>Mappers</strong> tab</li>
<li>Click <strong>Create</strong></li>
<li><strong>Name:</strong> <code>email-mapper</code></li>
<li><strong>Mapper type:</strong> Attribute Importer</li>
<li><strong>Attribute Name:</strong> <code>email</code></li>
<li><strong>Friendly Name:</strong> Email</li>
<li><strong>Name Format:</strong> ATTRIBUTE_FORMAT_BASIC</li>
<li><strong>User Attribute Name:</strong> <code>email</code></li>
<li>Click <strong>Save</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-23-optional-enable-auto-redirect-to-idp">Step 2.3: (Optional) Enable Auto-Redirect to IdP<a href="#step-23-optional-enable-auto-redirect-to-idp" class="hash-link" aria-label="Direct link to Step 2.3: (Optional) Enable Auto-Redirect to IdP" title="Direct link to Step 2.3: (Optional) Enable Auto-Redirect to IdP">​</a></h3>
<p>To skip the Keycloak login page and automatically redirect users to the external IdP:</p>
<ol>
<li><strong>Navigate to Authentication</strong> → <strong>Flows</strong> in your Keycloak realm</li>
<li>Select <strong>Browser</strong> flow (or your custom browser flow if you have one)</li>
<li>Find the <strong>Identity Provider Redirector</strong> execution</li>
<li>Click <strong>Actions</strong> → <strong>Config</strong></li>
<li>Set <strong>Alias:</strong> <code>auto-redirect-idp</code></li>
<li>Set <strong>Default Identity Provider:</strong> <code>yourcompany-idp</code> (must match your IdP alias exactly)</li>
<li>Click <strong>Save</strong></li>
</ol>
<p><strong>What this does:</strong> Users accessing the voting portal will be immediately redirected to the external IdP without seeing the Keycloak login page.</p>
<p><strong>When to use:</strong> Enable this when all voters must authenticate through the external IdP and you don&#x27;t need local Keycloak accounts.</p>
<p><strong>Admin access:</strong> You can still access Keycloak admin console directly at <code>{KEYCLOAK_URL}/admin/{realm}/console</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-24-run-end-to-end-test">Step 2.4: Run End-to-End Test<a href="#step-24-run-end-to-end-test" class="hash-link" aria-label="Direct link to Step 2.4: Run End-to-End Test" title="Direct link to Step 2.4: Run End-to-End Test">​</a></h3>
<ol>
<li>
<p><strong>Access the SimpleSAMLphp trigger page:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:8083/simplesaml/idp-initiated-sso.php</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Click &quot;Login to Voting Portal&quot;</strong></p>
</li>
<li>
<p><strong>Authenticate</strong> with test credentials (as configured in <code>SSP_EXAMPLE_USERS</code> env var):</p>
<ul>
<li>Default: Username: <code>user1</code> / Password: <code>password</code></li>
<li>Or: Username: <code>user2</code> / Password: <code>password</code></li>
</ul>
<p>You can customize test users by editing the <code>SSP_EXAMPLE_USERS</code> environment
variable in <code>.devcontainer/.env</code>. Format: <code>username1:password1:email1,username2:password2:email2,...</code></p>
</li>
<li>
<p><strong>Authenticated:</strong> You should get authenticated succesfully and redirected
to the voting portal. The intermiate steps that happens quickly one after
the other are:</p>
<ol>
<li>SimpleSAMLphp authenticates the user</li>
<li>SAML assertion is generated and POSTed to Keycloak</li>
<li>Keycloak validates the signature</li>
<li>Keycloak creates/updates user based on email attribute</li>
<li>Browser redirects to Voting Portal</li>
<li>Voting Portal detects user is authenticated and it lists available ballots</li>
</ol>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-25-troubleshooting-test-issues">Step 2.5: Troubleshooting Test Issues<a href="#step-25-troubleshooting-test-issues" class="hash-link" aria-label="Direct link to Step 2.5: Troubleshooting Test Issues" title="Direct link to Step 2.5: Troubleshooting Test Issues">​</a></h3>
<p><strong>Issue: Login timeout. Please sign in again</strong></p>
<ul>
<li>Verify <code>EVENT_ID</code> and <code>TENANT_ID</code> in <code>.env</code> are correct and that the Keycloak
Service provider entity ID is equal to the realm&#x27;s name, something like
<code>tenant-{TENANT_ID}-event-{EVENT_ID}</code></li>
</ul>
<p><strong>Issue: &quot;Identity Provider not found&quot;</strong></p>
<ul>
<li>Verify <code>SP_IDP_ALIAS</code> in <code>.env</code> matches the Keycloak Identity Provider alias</li>
</ul>
<p><strong>Issue: &quot;Signature validation failed&quot;</strong></p>
<ul>
<li>Ensure SimpleSAMLphp&#x27;s <code>server.crt</code> certificate is correctly pasted in Keycloak</li>
<li>Remove <code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code> lines</li>
<li>Check that SimpleSAMLphp is signing assertions (check <code>saml20-idp-hosted.php</code>)</li>
</ul>
<p><strong>Issue: &quot;User not created&quot;</strong></p>
<ul>
<li>Verify the <code>email</code> attribute mapper is configured in Keycloak</li>
<li>Check SimpleSAMLphp&#x27;s <code>authsources.php</code> includes <code>email</code> in user attributes</li>
<li>Verify the <code>SSP_EXAMPLE_USERS</code> environment variable is correctly formatted with emails</li>
</ul>
<p><strong>Issue: &quot;Wrong redirect URL&quot;</strong></p>
<ul>
<li>Verify the <code>RelayState</code> in SimpleSAMLphp&#x27;s <code>idp-initiated-sso.php</code></li>
<li>Check it matches the expected voting portal login URL pattern</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3-client-handoff">Phase 3: Client Handoff<a href="#phase-3-client-handoff" class="hash-link" aria-label="Direct link to Phase 3: Client Handoff" title="Direct link to Phase 3: Client Handoff">​</a></h2>
<p>Once testing is successful, prepare the handoff package for the client.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-31-information-package-for-client">Step 3.1: Information Package for Client<a href="#step-31-information-package-for-client" class="hash-link" aria-label="Direct link to Step 3.1: Information Package for Client" title="Direct link to Step 3.1: Information Package for Client">​</a></h3>
<p>Provide the client with:</p>
<ol>
<li><strong>Configuration Values (from Step 1.3)</strong></li>
<li><strong>Integration Guide:</strong> Link to <code>/docs/integrations/idp_initiated_sso_integration_guide</code></li>
<li><strong>Reference Implementation:</strong> Access to <code>.devcontainer/simplesamlphp/</code> in the Step repository</li>
<li><strong>Keycloak Metadata URL:</strong>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{SP_BASE_URL}/realms/tenant-{TENANT_ID}-event-{EVENT_ID}/broker/{SP_IDP_ALIAS}/endpoint/descriptor</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-32-request-from-client">Step 3.2: Request from Client<a href="#step-32-request-from-client" class="hash-link" aria-label="Direct link to Step 3.2: Request from Client" title="Direct link to Step 3.2: Request from Client">​</a></h3>
<p>Request the following from the client:</p>
<ol>
<li><strong>IdP Metadata URL</strong> (preferred) or:</li>
<li><strong>Manual configuration values:</strong>
<ul>
<li>IdP Entity ID</li>
<li>IdP SSO Service URL</li>
<li>IdP Single Logout Service URL (optional)</li>
<li>IdP public signing certificate (X.509 PEM format)</li>
</ul>
</li>
<li><strong>Test user credentials</strong> for staging verification</li>
<li><strong>Expected production go-live date</strong></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-33-configure-keycloak-with-client-idp">Step 3.3: Configure Keycloak with Client IdP<a href="#step-33-configure-keycloak-with-client-idp" class="hash-link" aria-label="Direct link to Step 3.3: Configure Keycloak with Client IdP" title="Direct link to Step 3.3: Configure Keycloak with Client IdP">​</a></h3>
<p>Once you receive the client&#x27;s IdP information:</p>
<ol>
<li>
<p><strong>Delete or disable the SimpleSAMLphp test Identity Provider</strong></p>
</li>
<li>
<p><strong>Create new Identity Provider</strong> for the client:</p>
<ul>
<li><strong>Alias:</strong> <code>{client-name}-idp</code> (use client organization name)</li>
<li><strong>Import client&#x27;s IdP metadata</strong> (preferred) or manually configure</li>
<li><strong>Configure same attribute mappers</strong> as in testing</li>
<li><strong>Enable signature validation</strong> (<code>Validate Signatures: ON</code>)</li>
<li><strong>Paste client&#x27;s public certificate</strong></li>
</ul>
</li>
<li>
<p><strong>Test with client:</strong></p>
<ul>
<li>Client initiates SSO from their IdP</li>
<li>Verify user attributes are correctly mapped</li>
<li>Verify redirect to voting portal works</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-34-production-handoff-checklist">Step 3.4: Production Handoff Checklist<a href="#step-34-production-handoff-checklist" class="hash-link" aria-label="Direct link to Step 3.4: Production Handoff Checklist" title="Direct link to Step 3.4: Production Handoff Checklist">​</a></h3>
<p>Before going live, verify:</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Keycloak realm configuration complete</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Client&#x27;s production IdP configured and trusted</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Production certificates exchanged</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Attribute mapping tested (email required)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->End-to-end test successful in staging environment</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Production URLs configured (no localhost references)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->HTTPS enabled on all endpoints</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Backup of Keycloak realm configuration taken</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Monitoring and logging enabled</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Client has integration guide documentation</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Go-live date coordinated with client</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-4-post-handoff-support">Phase 4: Post-Handoff Support<a href="#phase-4-post-handoff-support" class="hash-link" aria-label="Direct link to Phase 4: Post-Handoff Support" title="Direct link to Phase 4: Post-Handoff Support">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-client-issues">Common Client Issues<a href="#common-client-issues" class="hash-link" aria-label="Direct link to Common Client Issues" title="Direct link to Common Client Issues">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issue-1-saml-response-signature-invalid">Issue 1: &quot;SAML Response Signature Invalid&quot;<a href="#issue-1-saml-response-signature-invalid" class="hash-link" aria-label="Direct link to Issue 1: &quot;SAML Response Signature Invalid&quot;" title="Direct link to Issue 1: &quot;SAML Response Signature Invalid&quot;">​</a></h4>
<p><strong>Client Side:</strong></p>
<ul>
<li>Their IdP isn&#x27;t signing the response/assertion</li>
<li>Wrong signing algorithm</li>
<li>Certificate mismatch</li>
</ul>
<p><strong>Sequent Side:</strong></p>
<ul>
<li>Verify we have their correct public certificate in Keycloak</li>
<li>Check <code>Validate Signatures</code> is enabled</li>
<li>Verify signing algorithm matches (RSA-SHA256 or stronger)</li>
</ul>
<p><strong>Resolution:</strong></p>
<ul>
<li>Request updated certificate from client</li>
<li>Have client verify their IdP signing configuration</li>
<li>Use SAML tracer to inspect signature in assertion</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issue-2-invalid-audience-restriction">Issue 2: &quot;Invalid Audience Restriction&quot;<a href="#issue-2-invalid-audience-restriction" class="hash-link" aria-label="Direct link to Issue 2: &quot;Invalid Audience Restriction&quot;" title="Direct link to Issue 2: &quot;Invalid Audience Restriction&quot;">​</a></h4>
<p><strong>Cause:</strong> Client&#x27;s IdP is sending wrong audience value</p>
<p><strong>Resolution:</strong></p>
<ul>
<li>Client must set audience to: <code>tenant-{TENANT_ID}-event-{EVENT_ID}</code></li>
<li>Verify client has correct <code>SP_REALM</code> value</li>
<li>Reference the SimpleSAMLphp SP remote metadata configuration</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issue-3-user-not-created--email-missing">Issue 3: &quot;User Not Created / Email Missing&quot;<a href="#issue-3-user-not-created--email-missing" class="hash-link" aria-label="Direct link to Issue 3: &quot;User Not Created / Email Missing&quot;" title="Direct link to Issue 3: &quot;User Not Created / Email Missing&quot;">​</a></h4>
<p><strong>Cause:</strong> Email attribute not included in SAML assertion</p>
<p><strong>Resolution:</strong></p>
<ul>
<li>Verify Keycloak attribute mapper configuration</li>
<li>Have client check their IdP includes <code>email</code> attribute</li>
<li>Compare assertion structure with SimpleSAMLphp example</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issue-4-relaystate-not-working">Issue 4: &quot;RelayState Not Working&quot;<a href="#issue-4-relaystate-not-working" class="hash-link" aria-label="Direct link to Issue 4: &quot;RelayState Not Working&quot;" title="Direct link to Issue 4: &quot;RelayState Not Working&quot;">​</a></h4>
<p><strong>Cause:</strong> RelayState not preserved through flow</p>
<p><strong>Resolution:</strong></p>
<ul>
<li>Verify client&#x27;s IdP includes RelayState in SAML Response POST</li>
<li>Check client is using correct RelayState URL format</li>
<li>Test with SimpleSAMLphp to verify Keycloak side works</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issue-5-simplesamlphp-trigger-page-not-reachable-in-dev-env">Issue 5: &quot;SimpleSAMLphp trigger page not reachable in dev ENV&quot;<a href="#issue-5-simplesamlphp-trigger-page-not-reachable-in-dev-env" class="hash-link" aria-label="Direct link to Issue 5: &quot;SimpleSAMLphp trigger page not reachable in dev ENV&quot;" title="Direct link to Issue 5: &quot;SimpleSAMLphp trigger page not reachable in dev ENV&quot;">​</a></h4>
<p><strong>Cause:</strong> Bad ports configuration</p>
<p><strong>Resolution:</strong></p>
<ul>
<li>Check PORTS tab in vscode to verify whether simplesamlphp service port is being forwarded</li>
<li>Add simplesamlphp:8083</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-tools">Debugging Tools<a href="#debugging-tools" class="hash-link" aria-label="Direct link to Debugging Tools" title="Direct link to Debugging Tools">​</a></h3>
<ol>
<li>
<p><strong>SAML Tracer Browser Extension:</strong></p>
<ul>
<li>Firefox: SAML-tracer</li>
<li>Chrome: SAML Chrome Panel</li>
<li>Captures all SAML messages in flight</li>
</ul>
</li>
<li>
<p><strong>Keycloak Logs:</strong></p>
<ul>
<li>Enable DEBUG level logging for SAML broker</li>
<li>Check for signature validation errors</li>
<li>Look for attribute mapping issues</li>
</ul>
</li>
<li>
<p><strong>Client Comparison:</strong></p>
<ul>
<li>Compare client&#x27;s SAML assertion with SimpleSAMLphp reference</li>
<li>Verify structure matches expected format</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="escalation-path">Escalation Path<a href="#escalation-path" class="hash-link" aria-label="Direct link to Escalation Path" title="Direct link to Escalation Path">​</a></h3>
<p>If issues persist:</p>
<ol>
<li><strong>Review with internal dev team</strong> (reference design documentation)</li>
<li><strong>Request SAML tracer logs</strong> from client</li>
<li><strong>Compare assertions</strong> side-by-side with working SimpleSAMLphp example</li>
<li><strong>Schedule debug session</strong> with client technical team</li>
<li><strong>Check Keycloak version compatibility</strong> if using newer SAML features</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference-key-urls-and-patterns">Reference: Key URLs and Patterns<a href="#reference-key-urls-and-patterns" class="hash-link" aria-label="Direct link to Reference: Key URLs and Patterns" title="Direct link to Reference: Key URLs and Patterns">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keycloak-urls">Keycloak URLs<a href="#keycloak-urls" class="hash-link" aria-label="Direct link to Keycloak URLs" title="Direct link to Keycloak URLs">​</a></h3>
<p><strong>Realm identifier:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tenant-{TENANT_ID}-event-{EVENT_ID}</span><br></span></code></pre></div></div>
<p><strong>IdP metadata endpoint:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{SP_BASE_URL}/realms/{REALM_ID}/broker/{IDP_ALIAS}/endpoint/descriptor</span><br></span></code></pre></div></div>
<p><strong>ACS URL:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{SP_BASE_URL}/realms/{REALM_ID}/broker/{IDP_ALIAS}/endpoint/clients/{CLIENT_ID}</span><br></span></code></pre></div></div>
<p><strong>Redirect provider endpoint:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{SP_BASE_URL}/realms/{REALM_ID}/redirect-provider/redirect</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="voting-portal-urls">Voting Portal URLs<a href="#voting-portal-urls" class="hash-link" aria-label="Direct link to Voting Portal URLs" title="Direct link to Voting Portal URLs">​</a></h3>
<p><strong>Login page:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{VOTING_PORTAL_URL}/tenant/{TENANT_ID}/event/{EVENT_ID}/login</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="simplesamlphp-reference-files">SimpleSAMLphp Reference Files<a href="#simplesamlphp-reference-files" class="hash-link" aria-label="Direct link to SimpleSAMLphp Reference Files" title="Direct link to SimpleSAMLphp Reference Files">​</a></h3>
<ul>
<li><strong>Configuration:</strong> <code>.devcontainer/simplesamlphp/config.php</code></li>
<li><strong>Environment:</strong> <code>.devcontainer/simplesamlphp/.env.example</code></li>
<li><strong>IdP Metadata:</strong> <code>.devcontainer/simplesamlphp/metadata/saml20-idp-hosted.php</code></li>
<li><strong>SP Metadata:</strong> <code>.devcontainer/simplesamlphp/metadata/saml20-sp-remote.php</code></li>
<li><strong>Trigger Page:</strong> <code>.devcontainer/simplesamlphp/public/idp-initiated-sso.php</code></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources">​</a></h2>
<ul>
<li><strong>Third-Party Integration Guide:</strong> <a href="/docusaurus/main/docs/integrations/idp_initiated_sso_integration_guide">IdP-Initiated SSO Integration Guide</a></li>
<li><strong>Internal Design Documentation:</strong> <a href="/docusaurus/main/docs/developers/Keycloak/idp_initiated_sso_design_implementation">IdP-Initiated SSO Design &amp; Implementation</a></li>
<li><strong>SimpleSAMLphp Reference:</strong> <code>.devcontainer/simplesamlphp/README.md</code></li>
<li><strong>Keycloak Documentation:</strong> <a href="https://www.keycloak.org/docs/latest/server_admin/#_identity_broker" target="_blank" rel="noopener noreferrer">https://www.keycloak.org/docs/latest/server_admin/#_identity_broker</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/sequentech/step/docs/docusaurus/docs/developers/10-Tutorials/03-setup_idp_initiated_sso.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docusaurus/main/docs/developers/Tutorials/Load-Testing/load_testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Load Testing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docusaurus/main/docs/reference/reference"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Reference Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#what-this-guide-covers" class="table-of-contents__link toc-highlight">What This Guide Covers</a></li><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture Overview</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#phase-1-initial-keycloak-configuration" class="table-of-contents__link toc-highlight">Phase 1: Initial Keycloak Configuration</a><ul><li><a href="#step-11-create-or-verify-the-realm" class="table-of-contents__link toc-highlight">Step 1.1: Create or Verify the Realm</a></li><li><a href="#step-12-configure-the-vp-sso-saml-client" class="table-of-contents__link toc-highlight">Step 1.2: Configure the vp-sso SAML Client</a></li><li><a href="#step-13-prepare-configuration-for-client" class="table-of-contents__link toc-highlight">Step 1.3: Prepare Configuration for Client</a></li></ul></li><li><a href="#phase-2-test-with-simplesamlphp-reference-implementation" class="table-of-contents__link toc-highlight">Phase 2: Test with SimpleSAMLphp Reference Implementation</a><ul><li><a href="#step-21-set-up-simplesamlphp-locally" class="table-of-contents__link toc-highlight">Step 2.1: Set Up SimpleSAMLphp Locally</a></li><li><a href="#step-22-configure-keycloak-to-trust-simplesamlphp" class="table-of-contents__link toc-highlight">Step 2.2: Configure Keycloak to Trust SimpleSAMLphp</a></li><li><a href="#step-23-optional-enable-auto-redirect-to-idp" class="table-of-contents__link toc-highlight">Step 2.3: (Optional) Enable Auto-Redirect to IdP</a></li><li><a href="#step-24-run-end-to-end-test" class="table-of-contents__link toc-highlight">Step 2.4: Run End-to-End Test</a></li><li><a href="#step-25-troubleshooting-test-issues" class="table-of-contents__link toc-highlight">Step 2.5: Troubleshooting Test Issues</a></li></ul></li><li><a href="#phase-3-client-handoff" class="table-of-contents__link toc-highlight">Phase 3: Client Handoff</a><ul><li><a href="#step-31-information-package-for-client" class="table-of-contents__link toc-highlight">Step 3.1: Information Package for Client</a></li><li><a href="#step-32-request-from-client" class="table-of-contents__link toc-highlight">Step 3.2: Request from Client</a></li><li><a href="#step-33-configure-keycloak-with-client-idp" class="table-of-contents__link toc-highlight">Step 3.3: Configure Keycloak with Client IdP</a></li><li><a href="#step-34-production-handoff-checklist" class="table-of-contents__link toc-highlight">Step 3.4: Production Handoff Checklist</a></li></ul></li><li><a href="#phase-4-post-handoff-support" class="table-of-contents__link toc-highlight">Phase 4: Post-Handoff Support</a><ul><li><a href="#common-client-issues" class="table-of-contents__link toc-highlight">Common Client Issues</a></li><li><a href="#debugging-tools" class="table-of-contents__link toc-highlight">Debugging Tools</a></li><li><a href="#escalation-path" class="table-of-contents__link toc-highlight">Escalation Path</a></li></ul></li><li><a href="#reference-key-urls-and-patterns" class="table-of-contents__link toc-highlight">Reference: Key URLs and Patterns</a><ul><li><a href="#keycloak-urls" class="table-of-contents__link toc-highlight">Keycloak URLs</a></li><li><a href="#voting-portal-urls" class="table-of-contents__link toc-highlight">Voting Portal URLs</a></li><li><a href="#simplesamlphp-reference-files" class="table-of-contents__link toc-highlight">SimpleSAMLphp Reference Files</a></li></ul></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight">Additional Resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Sequent</div></div></div></footer></div>
</body>
</html>